---
/**
 * Plugins Hub — filtered listing of plugins.
 * Density: LOW (hero) → HIGH (directory) → LOW (CTA void)
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import ToolCard from '../../components/ToolCard.astro';

const allTools = await getCollection('tools');
const plugins = allTools.filter(t => t.data.type === 'plugin');

const schema = {
  '@type': 'BreadcrumbList',
  'itemListElement': [
    { '@type': 'ListItem', 'position': 1, 'name': 'Home', 'item': 'https://channel47.dev/' },
    { '@type': 'ListItem', 'position': 2, 'name': 'Plugins' },
  ],
};
---

<BaseLayout
  title="Plugins — Channel 47"
  description="Everything your role needs, one install. Skills, scripts, API connections, and safety hooks — packaged by profession."
  schema={schema}
>
  <Nav />

  <main id="main-content">

    <section class="pt-28 pb-0" data-section="hero">
      <div class="wrap">
        <Breadcrumbs items={[
          { label: 'Home', href: '/' },
          { label: 'Plugins' },
        ]} />
        <div class="accent-bar mt-4" aria-hidden="true"></div>
        <p class="label mt-5 mb-4">PLUGINS</p>
        <h1 class="text-[clamp(1.75rem,4vw,2.5rem)] font-semibold tracking-tight leading-[1.1] text-chalk mb-3" style="font-family: var(--font-family-display);">
          Everything your role needs, one install.
        </h1>
        <p class="font-mono text-sm text-dust tracking-wide mb-2">Skills, scripts, API connections, and safety hooks — packaged by profession.</p>
        <p class="font-mono text-[11px] text-stone mt-6 mb-0"><span id="visible-count">{plugins.length}</span> plugins</p>
      </div>
    </section>

    <section class="py-8" data-section="plugins-directory">
      <div class="wrap">
        <div class="mb-5">
          <label for="plugin-search" class="sr-only">Search plugins</label>
          <input
            type="text"
            id="plugin-search"
            placeholder="Search plugins..."
            class="w-full px-4 h-10 font-mono text-sm text-bone bg-soot/80 border border-smoke rounded-tight outline-none transition-[border-color,box-shadow] duration-100 placeholder:text-stone hover:border-ash focus-visible:border-signal focus-visible:shadow-[0_0_0_4px_rgba(245,158,11,0.2)]"
            autocomplete="off"
            spellcheck="false"
            data-hub-search
          />
        </div>

        <div id="hub-list">
          {plugins.map((tool, i) => (
            <ToolCard
              name={tool.data.name}
              description={tool.data.description}
              type={tool.data.type}
              href={`/plugins/${tool.id.split('/').pop()?.replace(/\.md$/, '')}`}
              index={i + 1}
            />
          ))}
        </div>

        <p id="no-results" class="font-mono text-sm text-stone py-8 hidden">No plugins match your search.</p>
      </div>
    </section>

    <section class="cta" data-section="plugins-cta">
      <p class="label">CH47</p>
      <a class="cta__headline" href="/">Browse the full directory</a>
      <a href="/subscribe" class="btn-signal">Subscribe to Build Notes</a>
    </section>

    <Footer />
  </main>

  <script>
    import { initHubSearch } from '../../scripts/hub-search';

    function init() { initHubSearch(); }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else { init(); }
    document.addEventListener('astro:page-load', init);
  </script>
</BaseLayout>
