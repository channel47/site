---
/**
 * Homepage
 * ch47 compositional narrative: density map, signature moves.
 *
 * Density: LOW (hero) → HIGH (proof strip) → MEDIUM (how it works) →
 *          LOW/light (rupture/thesis) → MEDIUM (signup) → LOW (cta void)
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import EmailSignup from '../components/EmailSignup.astro';
import ContentCard from '../components/ContentCard.astro';

const allNotes = (await getCollection('notes', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestNote = allNotes.find((n) => n.data.featured) || allNotes[0];

const schema = [
  {
    '@type': 'Organization',
    'name': 'Channel 47',
    'url': 'https://channel47.dev',
    'logo': 'https://channel47.dev/og-image.png',
    'description': 'Open-source plugin ecosystem for Claude Code. Skills replace tasks. Plugins package professions.',
    'founder': {
      '@type': 'Person',
      'name': 'Jackson Dean',
      'url': 'https://x.com/ctrlswing',
    },
    'sameAs': [
      'https://github.com/channel47',
      'https://x.com/ctrlswing',
      'https://github.com/ctrlswing',
      'https://www.linkedin.com/in/jackson-d-9979a7a0/',
    ],
  },
  {
    '@type': 'WebSite',
    'name': 'Channel 47',
    'url': 'https://channel47.dev',
  },
];
---

<BaseLayout
  title="Channel 47 — AI Plugins for Every Profession"
  description="Skills replace tasks. Plugins replace professions. Open-source AI skills ecosystem organized by what you do for work. Season 01: Media Buyer."
  schema={schema}
>
  <main class="pg">

    <!-- =======================================
         ACT 1: HERO (LOW density)
         Sparse. Commanding. 90vh.
         ======================================= -->
    <section class="hero" data-section="hero">
      <Nav currentPath="/" />
      <div class="hero__content">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label">SEASON 01 — MEDIA BUYERS</p>
        <h1 class="hero__headline" id="hero-headline">
          Plugins that package professions.
        </h1>
        <p class="hero__sub">
          Open-source plugins for Claude Code. Season 01 ships the
          media buyer. Every skill, script, and hook a paid-search practitioner
          needs, built from managing 25+ accounts. Install it and go. Or build
          your own.
        </p>
        <a class="hero__cta" href="/build?start">Build your first skill</a>
      </div>
    </section>

    <!-- =======================================
         ACT 2: PROOF STRIP (HIGH density)
         Dense. Understated. Quiet credibility.
         ======================================= -->
    <section class="stats" data-section="stats">
      <div class="stats__item">
        <span class="stats__value">25+</span>
        <span class="stats__label">Accounts managed</span>
      </div>
      <span class="stats__pipe" aria-hidden="true"></span>
      <div class="stats__item stats__item--signal">
        <span class="stats__value">S01</span>
        <span class="stats__label">Media buyers</span>
      </div>
      <span class="stats__pipe" aria-hidden="true"></span>
      <div class="stats__item">
        <span class="stats__value">10+</span>
        <span class="stats__label">Skills shipped</span>
      </div>
    </section>

    <!-- =======================================
         ACT 3: WHY THIS EXISTS (MEDIUM density)
         Narrative. Contained prose.
         ======================================= -->
    <section class="why" data-section="why">
      <div class="why__content">
        <div class="accent-bar" aria-hidden="true"></div>
        <p class="label">WHAT'S IN THE TOOLKIT</p>
        <div class="why__prose">
          <p>Three layers that cover an entire profession. Use them together
             or pull what you need.</p>
          <div class="why__items">
            <div class="why__item">
              <span class="why__idx" aria-hidden="true">001</span>
              <p><strong>Skills</strong> — Markdown instructions AI follows every time.
                 Your process, your standards, your judgment calls. Reusable across
                 every account, every client.</p>
            </div>
            <div class="why__item">
              <span class="why__idx" aria-hidden="true">002</span>
              <p><strong>MCP Servers</strong> — Standalone API connections. Google Ads,
                 Bing Ads, image generation. Use them independently or let the plugin bundle them.</p>
            </div>
            <div class="why__item">
              <span class="why__idx" aria-hidden="true">003</span>
              <p><strong>Hooks</strong> — Safety layer. Every mutation gets intercepted,
                 previewed, and approved before execution. You stay in control.</p>
            </div>
          </div>
          <div class="why__callout">
            <p>$3K/month in wasted ad spend. Caught by one skill inside the toolkit.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- =======================================
         ACT 3.5: TOOLKIT TEASER (MEDIUM density)
         Compact summary driving to /tools.
         ======================================= -->
    <section class="teaser" data-section="teaser">
      <div class="teaser__content">
        <p class="label">SEASON 01 — THE TOOLKIT</p>
        <p class="teaser__intro">
          Three MCP servers. Five skills. One plugin. Built from managing 25+ accounts daily.
        </p>
        <div class="teaser__stats">
          <span class="teaser__stat">3 MCP Servers</span>
          <span class="teaser__pipe" aria-hidden="true"></span>
          <span class="teaser__stat">5 Skills</span>
          <span class="teaser__pipe" aria-hidden="true"></span>
          <span class="teaser__stat teaser__stat--accent">1 Plugin</span>
        </div>
        <a class="teaser__cta" href="/tools">Explore the toolkit &rarr;</a>
      </div>
    </section>

    <!-- =======================================
         ACT 3.75: LATEST NOTE (MEDIUM density)
         Keeps homepage alive with flowing content.
         ======================================= -->
    {latestNote && (
      <section class="latest" data-section="latest">
        <div class="latest__content">
          <p class="label">LATEST FROM BUILD NOTES</p>
          <ContentCard
            title={latestNote.data.title}
            description={latestNote.data.description}
            date={latestNote.data.date}
            tag={latestNote.data.tag}
            slug={latestNote.id.replace(/\.md$/, '')}
          />
          <a href="/notes" class="latest__all">All notes &rarr;</a>
        </div>
      </section>
    )}

    <!-- =======================================
         ACT 4: RUPTURE (LOW density, light surface)
         The pattern break. Surface flip + density shift.
         ======================================= -->
    <section class="rupture" data-section="rupture">
      <div class="rupture__bar" aria-hidden="true"></div>
      <div class="rupture__inner">
        <p class="rupture__label label">047 / THESIS</p>
        <h2 class="rupture__headline rupture__headline--home">Skills replace tasks.<br />Plugins replace professions.</h2>
      </div>
    </section>

    <!-- =======================================
         ACT 5: SIGNUP (MEDIUM density)
         ======================================= -->
    <section class="signup" id="signup" data-section="signup">
      <div class="signup__content">
        <p class="label">BUILD NOTES</p>
        <h2 class="signup__title">Every week, one skill from the ecosystem. Broken down.</h2>
        <ul class="signup__list">
          <li>How it was built and why the design decisions matter.</li>
          <li>What I'd change next time.</li>
          <li>Templates you can take, remix, and contribute back.</li>
        </ul>
        <p class="signup__micro">No spam. Unsubscribe anytime.</p>
        <EmailSignup placeholder="you@domain.com" tag="home" submitText="Get the breakdowns" />
      </div>
    </section>

    <!-- =======================================
         ACT 6: CTA (LOW density, The Void)
         Confident close. Conversion first, social second.
         ======================================= -->
    <section class="cta" data-section="cta">
      <p class="label">TRANSMITTING</p>
      <a class="cta__action" href="/build?start">Build your first skill</a>
    </section>

    <!-- Footer -->
    <Footer />
  </main>

  <!-- =======================================
       MOTION: Hero sequence + Scroll reveals + Glitch
       ======================================= -->
  <script>
    import { initPageMotion } from '../scripts/page-motion';
    initPageMotion();
  </script>
</BaseLayout>

<!-- Shared section styles (hero, CTA, label, keyframes) -->
<style is:global>
  @import '../styles/sections.css';
</style>

<style>
  /* ========================================
   * Homepage — page-specific styles
   * ======================================== */

  /* ---- Hero CTA button ---- */
  .hero__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 44px;
    padding: 0 24px;
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
    color: var(--color-fg-inverse);
    background: var(--color-accent);
    border-radius: 2px;
    width: fit-content;
    margin-top: 32px;
    opacity: 0;
    transition:
      background-color 150ms var(--ease-sharp),
      color 100ms var(--ease-sharp),
      box-shadow 200ms var(--ease-out),
      transform 200ms var(--ease-out);
  }

  [data-section="hero"].is-visible .hero__cta {
    animation: fadeUp 400ms var(--ease-out) 900ms forwards;
  }

  .hero__cta:hover {
    background: var(--color-fg);
    color: var(--color-bg);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-1px);
  }

  .hero__cta:active {
    transform: translateY(0);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition-duration: 50ms;
  }

  .hero__cta:focus-visible {
    outline: 2px solid var(--color-fg);
    outline-offset: 2px;
  }

  /* ---- Why Section (MEDIUM density) ---- */
  .why {
    padding: clamp(60px, 10vh, 100px) clamp(24px, 5vw, 64px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .why.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .why__content .accent-bar {
    width: 0;
  }

  .why__content .label {
    margin-top: 20px;
    margin-bottom: 24px;
  }

  .why__prose {
    display: grid;
    gap: 20px;
    max-width: 600px;
  }

  .why__prose p {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    margin: 0;
    letter-spacing: 0.02em;
  }

  .why__items {
    display: grid;
    gap: 16px;
  }

  .why__item {
    display: flex;
    gap: 16px;
    align-items: baseline;
  }

  .why__idx {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--color-border);
    letter-spacing: 0.1em;
    flex-shrink: 0;
  }

  .why__item p {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg);
    letter-spacing: 0.02em;
    margin: 0;
  }

  .why__item strong {
    font-weight: 600;
    color: var(--color-fg-emphasis);
  }

  .why__callout {
    padding: 16px 20px;
    background: var(--color-light-canvas);
    border: none;
    border-left: 2px solid var(--color-accent);
    border-radius: 0 2px 2px 0;
    transition:
      background-color 100ms var(--ease-sharp),
      box-shadow 200ms var(--ease-out);
  }

  .why__callout:hover {
    background: var(--color-light-paper);
    box-shadow: 0 2px 12px rgba(245, 158, 11, 0.08);
  }

  .why__callout p {
    color: var(--color-light-ink);
    font-weight: 500;
  }

  /* ---- Signup (MEDIUM density) ---- */
  .signup {
    padding: clamp(80px, 12vh, 120px) clamp(24px, 5vw, 64px) clamp(60px, 10vh, 100px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .signup.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .signup__content .label {
    margin-bottom: 8px;
  }

  .signup__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: var(--color-fg-emphasis);
    margin-bottom: 20px;
  }

  .signup__list {
    margin: 0 0 20px 0;
    padding-left: 24px;
    display: grid;
    gap: 6px;
  }

  .signup__list li {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg);
    letter-spacing: 0.02em;
  }

  .signup__list li::marker {
    color: var(--color-fg-muted);
  }

  .signup__micro {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.1em;
    color: var(--color-fg-muted);
    margin-bottom: 16px;
    text-transform: uppercase;
  }

  /* ---- Toolkit Teaser (MEDIUM density) ---- */
  .teaser {
    padding: clamp(40px, 6vh, 60px) clamp(24px, 5vw, 64px);
    background: var(--color-bg-elevated);
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .teaser.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .teaser__content .label {
    margin-bottom: 8px;
  }

  .teaser__intro {
    font-family: var(--font-display);
    font-size: clamp(1.1rem, 2.5vw, 1.5rem);
    font-weight: 500;
    color: var(--color-fg-emphasis);
    margin-bottom: 20px;
    letter-spacing: -0.02em;
    max-width: 540px;
  }

  .teaser__stats {
    display: flex;
    align-items: center;
    gap: clamp(12px, 2vw, 24px);
    margin-bottom: 20px;
  }

  .teaser__stat {
    font-family: var(--font-mono);
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.05em;
    color: var(--color-fg-muted);
  }

  .teaser__stat--accent {
    color: var(--color-accent);
  }

  .teaser__pipe {
    width: 1px;
    height: 16px;
    background: var(--color-border);
  }

  .teaser__cta {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
    color: var(--color-accent);
    transition: color 150ms var(--ease-sharp);
  }

  .teaser__cta:hover {
    color: var(--color-fg);
  }

  .teaser__cta:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 4px;
  }

  /* ---- Rupture (LOW density, light surface) ---- */
  .rupture__inner {
    padding: clamp(100px, 16vh, 180px) clamp(24px, 5vw, 64px);
  }

  .rupture__headline--home {
    font-size: clamp(1.75rem, 4vw, 2.75rem);
  }

  /* ---- CTA Action (confident close) ---- */
  .cta__action {
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 500;
    color: var(--color-fg-emphasis);
    text-decoration: none;
    position: relative;
    display: inline-block;
    margin-bottom: 40px;
    transition: color 150ms var(--ease-out);
  }

  .cta__action::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -6px;
    width: 100%;
    height: 2px;
    background: var(--color-accent);
    transform-origin: left;
    transition: transform 250ms var(--ease-out);
  }

  .cta__action:hover {
    color: var(--color-accent);
  }

  .cta__action:hover::after {
    transform: scaleX(0);
    transform-origin: right;
  }

  .cta__action:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 4px;
  }

  /* ---- Latest Note (MEDIUM density) ---- */
  .latest {
    padding: clamp(40px, 6vh, 60px) clamp(24px, 5vw, 64px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .latest.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .latest__content {
    max-width: 600px;
  }

  .latest__content .label {
    margin-bottom: 8px;
  }

  .latest__all {
    display: inline-block;
    margin-top: 16px;
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
    color: var(--color-fg-muted);
    transition: color 150ms var(--ease-sharp);
  }

  .latest__all:hover {
    color: var(--color-accent);
  }

  /* ---- Reduced Motion ---- */
  @media (prefers-reduced-motion: reduce) {
    .hero__cta {
      opacity: 1 !important;
      transition: none !important;
    }

    .why__callout,
    .teaser,
    .teaser__cta,
    .latest,
    .cta__action,
    .cta__action::after {
      transition: none !important;
    }

    .teaser,
    .latest {
      opacity: 1 !important;
    }
  }
</style>
