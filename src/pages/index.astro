---
/**
 * Homepage
 * ch47 compositional narrative: density map, signature moves, rupture.
 *
 * Density: LOW (hero) → HIGH (stats) → MEDIUM (why) → HIGH (features) →
 *          LOW rupture (light inversion, void) → MEDIUM (signup) → LOW (cta void)
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import EmailSignup from '../components/EmailSignup.astro';
import SocialLinks from '../components/SocialLinks.astro';
---

<BaseLayout
  title="Channel47 — building an autonomous Google Ads agent"
  description="Media buyer building an open-source AI agent that manages Google Ads like a senior buyer — audits, fixes, pacing, queries — and sharing the build in public."
>
  <main class="pg">

    <!-- =======================================
         ACT 1: HERO (LOW density)
         Sparse. Commanding. 90vh.
         ======================================= -->
    <section class="hero" data-section="hero">
      <Nav currentPath="/" />
      <div class="hero__content">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label">BUILDING IN PUBLIC</p>
        <h1 class="hero__headline" id="hero-headline">
          Stop clicking.<br />Start supervising.
        </h1>
        <p class="hero__sub">
          I'm a media buyer building an open-source AI agent that manages
          Google Ads the way a senior buyer would — audits, fixes, pacing,
          queries, the whole loop.
        </p>
        <a class="hero__cta" href="#signup">Get the build notes</a>
      </div>
    </section>

    <!-- =======================================
         ACT 2: PROOF STRIP (HIGH density)
         Dense, quiet credibility. scale-in entrance.
         ======================================= -->
    <section class="stats" data-section="stats">
      <div class="stats__item" data-animate="fade-up" data-stagger="1">
        <span class="stats__value">25+</span>
        <span class="stats__label">ACCOUNTS MANAGED</span>
      </div>
      <div class="stats__pipe" aria-hidden="true"></div>
      <div class="stats__item" data-animate="fade-up" data-stagger="3">
        <span class="stats__value">$3K</span>
        <span class="stats__label">WASTE CAUGHT / MONTH</span>
      </div>
      <div class="stats__pipe" aria-hidden="true"></div>
      <div class="stats__item" data-animate="fade-up" data-stagger="5">
        <span class="stats__value">1</span>
        <span class="stats__label">AGENT IN PROGRESS</span>
      </div>
    </section>

    <!-- =======================================
         ACT 3: WHY THIS EXISTS (MEDIUM density)
         Narrative. Contained prose.
         ======================================= -->
    <section class="why" data-section="why">
      <div class="why__content">
        <div class="accent-bar" aria-hidden="true"></div>
        <p class="label">WHY THIS EXISTS</p>
        <div class="why__prose">
          <p>I manage 25+ accounts across multiple MCCs. The job isn't strategy
             most days — it's the same checklist on repeat.</p>
          <ul class="why__list">
            <li>Check pacing.</li>
            <li>Pull search terms.</li>
            <li>Pause the obvious waste.</li>
            <li>Fix extensions.</li>
            <li>Flag the budget that's about to blow.</li>
          </ul>
          <p>I started automating pieces of it with a Claude Code plugin.</p>
          <div class="why__callout">
            <p>One script caught a negative keyword gap burning ~$3K/month across two accounts.</p>
            <p>Another flagged a pacing issue 4 days before the client noticed.</p>
          </div>
          <p>That's when it clicked: these aren't one-off scripts. This is an agent.</p>
        </div>
      </div>
    </section>

    <!-- =======================================
         ACT 4: WHAT IT DOES (HIGH density)
         Asymmetric two-panel grid. Staggered items.
         ======================================= -->
    <section class="features" data-section="features">
      <div class="features__grid">
        <div class="features__panel features__panel--primary">
          <div class="features__bar" aria-hidden="true"></div>
          <span class="label">047.LOOP</span>
          <h2 class="features__title">audit &rarr; decide &rarr;<br />execute &rarr; report</h2>
          <p class="features__body">
            The agent runs a loop with guardrails so you approve changes
            instead of living in the UI. Every change comes with reasoning
            you can read, approve, or override.
          </p>
        </div>
        <div class="features__panel features__panel--secondary">
          <span class="label">WHAT THAT MEANS</span>
          <div class="features__list">
            <div class="features__item" data-animate="fade-up" data-stagger="1">
              <span class="features__idx">001</span>
              <span>Catches the expensive miss you're too busy to find</span>
            </div>
            <div class="features__item" data-animate="fade-up" data-stagger="3">
              <span class="features__idx">002</span>
              <span>Does Monday morning work before Monday morning</span>
            </div>
            <div class="features__item" data-animate="fade-up" data-stagger="5">
              <span class="features__idx">003</span>
              <span>Explains itself in plain English</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- =======================================
         ACT 5: RUPTURE (Light inversion, LOW density)
         Surface + density shift. The Void on light.
         One commanding number. Maximum negative space.
         ======================================= -->
    <section class="rupture" data-section="rupture">
      <div class="rupture__bar" aria-hidden="true"></div>
      <div class="rupture__void">
        <span class="label rupture__label">047 / STATUS</span>
        <div class="rupture__stat">
          <span class="rupture__number">$3K</span>
          <span class="rupture__unit">/ month in waste caught by one script.</span>
        </div>
        <p class="rupture__kicker">
          This isn't vaporware. The plugin runs in production on my accounts.
          Building the full agent in public — code on GitHub, decisions and dead ends included.
          When it's ready, it ships open-source.
        </p>
      </div>
    </section>

    <!-- =======================================
         ACT 6: SIGNUP (MEDIUM density)
         ======================================= -->
    <section class="signup" id="signup" data-section="signup">
      <div class="signup__content">
        <div class="accent-bar" aria-hidden="true"></div>
        <p class="label">INCOMING</p>
        <h2 class="signup__title">Build notes.</h2>
        <p class="signup__body">
          Short emails when something real ships. Prompt templates,
          automation scripts, and the architecture decisions behind an
          agent that actually touches live ad accounts.
        </p>
        <ul class="signup__list">
          <li>Working automations and scripts.</li>
          <li>Prompt templates and playbooks.</li>
          <li>Architecture decisions (and dead ends).</li>
        </ul>
        <p class="signup__micro">No spam. Unsubscribe anytime.</p>
        <EmailSignup placeholder="you@domain.com" tag="home" submitText="Get notes" />
      </div>
    </section>

    <!-- =======================================
         ACT 7: CTA (LOW density, The Void)
         One element. Maximum space.
         ======================================= -->
    <section class="cta" data-section="cta">
      <p class="label">TRANSMITTING</p>
      <a class="cta__link" href="#signup">Stop clicking. Start supervising.</a>
      <nav class="cta__links" aria-label="Links">
        <SocialLinks />
      </nav>
    </section>

    <!-- Footer -->
    <Footer />
  </main>

  <!-- =======================================
       MOTION: Hero sequence + Scroll reveals + Glitch
       ======================================= -->
  <script>
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReduced) {
      document.querySelectorAll('[data-section]').forEach(el => el.classList.add('is-visible'));
    } else {
      // Hero sequence choreography
      (function heroSequence() {
        const hero = document.querySelector('[data-section="hero"]');
        if (!hero) return;
        hero.classList.add('is-visible');

        const headline = document.getElementById('hero-headline');
        if (!headline) return;

        let glitched = false;
        setTimeout(() => {
          if (glitched) return;
          glitched = true;
          triggerGlitch(headline);
        }, 1100);
      })();

      // Scroll reveal for other sections
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15, rootMargin: '0px 0px -40px 0px' }
      );

      document.querySelectorAll('[data-section]:not([data-section="hero"])').forEach(el => {
        observer.observe(el);
      });
    }

    // Glitch function
    function triggerGlitch(el: HTMLElement) {
      const offsets = [
        { x: -3, y: 1 }, { x: 2, y: -1 },
        { x: -1, y: 2 }, { x: 1, y: -1 }, { x: 0, y: 0 },
      ];
      let start: number | null = null;

      function step(ts: number) {
        if (!start) start = ts;
        const elapsed = ts - start;
        if (elapsed > 160) {
          el.style.transform = 'translate(0, 0)';
          el.classList.remove('glitching');
          return;
        }
        const frame = offsets[Math.floor(elapsed / 35) % offsets.length];
        el.style.transform = `translate(${frame.x}px, ${frame.y}px)`;
        el.classList.add('glitching');
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // Hover glitch on headline
    const headline = document.getElementById('hero-headline');
    if (headline && !prefersReduced) {
      let glitchCooldown = false;
      headline.addEventListener('mouseenter', () => {
        if (glitchCooldown) return;
        glitchCooldown = true;
        triggerGlitch(headline);
        setTimeout(() => { glitchCooldown = false; }, 500);
      });
    }
  </script>
</BaseLayout>

<!-- Shared section styles (hero, stats, rupture, CTA, label, keyframes) -->
<style is:global>
  @import '../styles/sections.css';
</style>

<style>
  /* ========================================
   * Homepage — page-specific styles
   * ======================================== */

  /* ---- Hero CTA button ---- */
  .hero__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 44px;
    padding: 0 24px;
    font-family: var(--font-mono);
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.025em;
    color: var(--color-fg-inverse);
    background: var(--color-accent);
    border-radius: 2px;
    width: fit-content;
    margin-top: 32px;
    opacity: 0;
    transition:
      background-color var(--duration-fast) var(--ease-out),
      box-shadow var(--duration-fast) var(--ease-out);
  }

  [data-section="hero"].is-visible .hero__cta {
    animation: fadeUp 400ms var(--ease-out) 900ms forwards;
  }

  .hero__cta:hover {
    background: var(--color-accent-hover);
    box-shadow: 0 10px 30px rgba(245, 158, 11, 0.2);
  }

  .hero__cta:active {
    background: var(--color-accent-active);
    box-shadow: none;
  }

  .hero__cta:focus-visible {
    outline: 2px solid var(--color-fg);
    outline-offset: 2px;
  }

  /* ---- Why Section (MEDIUM density) ---- */
  .why {
    padding: clamp(60px, 10vh, 100px) clamp(24px, 5vw, 64px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .why.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .why__content .accent-bar {
    width: 0;
  }

  .why__content .label {
    margin-top: 20px;
    margin-bottom: 24px;
  }

  .why__prose {
    display: grid;
    gap: 20px;
    max-width: 600px;
  }

  .why__prose p {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    margin: 0;
    letter-spacing: 0.02em;
  }

  .why__list {
    margin: 0;
    padding-left: 24px;
    display: grid;
    gap: 6px;
  }

  .why__list li {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg);
    letter-spacing: 0.02em;
  }

  .why__list li::marker {
    color: var(--color-fg-muted);
  }

  .why__callout {
    display: grid;
    gap: 12px;
    padding: 16px 20px;
    border: 1px solid var(--color-border);
    background: var(--color-bg-elevated);
    border-radius: 2px;
  }

  .why__callout p {
    color: var(--color-fg);
  }

  /* ---- Features (HIGH density, asymmetric) ---- */
  .features {
    padding: 0;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .features.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .features__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1px;
    background-color: var(--color-border);
  }

  @media (min-width: 768px) {
    .features__grid {
      grid-template-columns: 3fr 2fr;
    }
  }

  .features__panel {
    padding: clamp(32px, 5vh, 56px) clamp(24px, 4vw, 48px);
  }

  .features__panel--primary {
    background-color: var(--color-bg-elevated);
    display: flex;
    flex-direction: column;
  }

  .features__panel--secondary {
    background-color: var(--color-bg-surface);
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .features__bar {
    width: 0;
    height: 2px;
    background-color: var(--color-accent);
    margin-bottom: 24px;
  }

  .features.is-visible .features__bar {
    animation: drawH 400ms var(--ease-out) 200ms forwards;
  }

  .features__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 3vw, 2.5rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: var(--color-fg-emphasis);
    margin-top: 12px;
  }

  .features__body {
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    margin-top: 20px;
    max-width: 480px;
    letter-spacing: 0.02em;
  }

  .features__list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .features__item {
    display: flex;
    align-items: baseline;
    gap: 16px;
    padding: 16px 0;
    border-bottom: 1px solid var(--color-border);
    font-size: 14px;
    line-height: 1.6;
    color: var(--color-fg);
    letter-spacing: 0.02em;
  }

  .features__item:first-child {
    padding-top: 0;
  }

  .features__idx {
    font-size: 11px;
    color: var(--color-border);
    letter-spacing: 0.1em;
    flex-shrink: 0;
    width: 32px;
  }

  /* ---- Rupture (Light inversion, LOW density — The Void) ---- */
  .rupture {
    padding: clamp(100px, 18vh, 200px) clamp(24px, 5vw, 64px);
  }

  .rupture__bar {
    top: clamp(100px, 18vh, 200px);
  }

  .rupture__void {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    max-width: 640px;
    margin-left: clamp(0px, 8%, 120px);
  }

  .rupture__stat {
    margin-top: 16px;
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: 12px;
  }

  .rupture__number {
    font-family: var(--font-display);
    font-size: clamp(4rem, 12vw, 8rem);
    font-weight: 700;
    letter-spacing: -0.05em;
    line-height: 0.85;
    color: #1C1917;
  }

  .rupture__unit {
    font-family: var(--font-mono);
    font-size: clamp(0.875rem, 2vw, 1.125rem);
    line-height: 1.4;
    color: var(--color-fg-muted);
    letter-spacing: 0.02em;
    max-width: 280px;
  }

  .rupture__kicker {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-muted);
    margin-top: clamp(40px, 6vh, 80px);
    max-width: 480px;
    letter-spacing: 0.02em;
  }

  /* ---- Signup (MEDIUM density) ---- */
  .signup {
    padding: clamp(80px, 12vh, 120px) clamp(24px, 5vw, 64px) clamp(60px, 10vh, 100px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .signup.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .signup__content .accent-bar {
    width: 0;
  }

  .signup__content .label {
    margin-top: 20px;
    margin-bottom: 8px;
  }

  .signup__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: var(--color-fg-emphasis);
    margin-bottom: 20px;
  }

  .signup__body {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    max-width: 520px;
    margin-bottom: 24px;
    letter-spacing: 0.02em;
  }

  .signup__list {
    margin: 0 0 20px 0;
    padding-left: 24px;
    display: grid;
    gap: 6px;
  }

  .signup__list li {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg);
    letter-spacing: 0.02em;
  }

  .signup__list li::marker {
    color: var(--color-fg-muted);
  }

  .signup__micro {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.1em;
    color: var(--color-fg-muted);
    margin-bottom: 16px;
    text-transform: uppercase;
  }

  /* ---- CTA (LOW density, The Void) ---- */
  .cta__link {
    font-family: var(--font-display);
    font-size: clamp(1.25rem, 3.5vw, 2rem);
    font-weight: 500;
    color: var(--color-fg-emphasis);
    text-decoration: underline;
    text-underline-offset: 8px;
    text-decoration-color: var(--color-accent);
    text-decoration-thickness: 2px;
    transition: color var(--duration-fast);
  }

  .cta__link:hover { color: var(--color-accent); }

  .cta__links {
    margin-top: 40px;
    opacity: 0.6;
    transition: opacity var(--duration-normal) var(--ease-out);
  }

  .cta__links:hover {
    opacity: 1;
  }

  /* ---- Reduced Motion ---- */
  @media (prefers-reduced-motion: reduce) {
    .features__bar {
      width: 40px !important;
    }
  }
</style>
