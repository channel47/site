---
/**
 * Homepage - Founder Journey Landing Page (V6)
 *
 * Refined editorial design with authentic Claude Code terminal.
 * Unified typography, wider content, reserved CTAs.
 *
 * Changes from V5:
 * - Wider content area on desktop for breathing room
 * - Authentic Claude Code terminal showing conversational interaction
 * - Simplified, inline email optins
 * - Unified headline typography (fewer font/color variations)
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import Prose from '../components/Prose.astro';
import EmailSignup from '../components/EmailSignup.astro';
import LogoAnimated from '../components/LogoAnimated.astro';
import SocialLinks from '../components/SocialLinks.astro';
import AnimatedName from '../components/AnimatedName.astro';
---

<BaseLayout
  title="Channel47 — Claude Code plugin for media buyers"
  description="A free Claude Code plugin for Google Ads, built by someone who can't code. New features shipping constantly."
>
  <main class="page">
    <!-- Atmospheric orb - subtle warmth behind content -->
    <div class="atmosphere" aria-hidden="true">
      <div class="atmosphere__orb"></div>
    </div>

    <Prose width="wide">
      <!-- Hero: Claim → Cliffhanger → Payoff -->
      <header class="hero">
        <p class="hero__overline" data-animate="fade-up" data-stagger="1">A Claude Code Plugin for Google Ads</p>
        <h1 class="hero__headline" data-animate="blur-in" data-stagger="2">
          Manage Google Ads from your terminal.
          <span class="hero__headline-break">In plain English.</span>
        </h1>

        <!-- Claude Code terminal - animated conversation -->
        <div class="claude-terminal" data-animate="fade-up" data-stagger="2" data-terminal-animate>
          <div class="claude-terminal__chrome">
            <div class="claude-terminal__dots">
              <span></span><span></span><span></span>
            </div>
            <div class="claude-terminal__title">claude</div>
          </div>
          <div class="claude-terminal__content">
            <!-- Beat 1: The Ask -->
            <div class="claude-terminal__message claude-terminal__message--user" data-beat="1">
              <span class="claude-terminal__prompt">›</span>
              <span class="claude-terminal__text" data-typewriter>Audit my campaigns for RSA best practices and find any missing extensions</span>
            </div>

            <!-- Thinking indicator (shown between beats) -->
            <div class="claude-terminal__thinking" data-thinking="1" aria-live="polite">
              <span class="claude-terminal__thinking-spinner"></span>
              <span class="claude-terminal__thinking-text">Thinking</span>
            </div>

            <!-- Beat 2: The Discovery -->
            <div class="claude-terminal__message claude-terminal__message--claude" data-beat="2">
              <div class="claude-terminal__claude-indicator" data-reveal="indicator">
                <span class="claude-terminal__claude-icon">●</span>
                <span class="claude-terminal__claude-name">Claude</span>
              </div>
              <div class="claude-terminal__response">
                <p class="claude-terminal__response-text" data-reveal="text">I'll check your campaigns for RSA best practices and scan for missing extensions.</p>
                <div class="claude-terminal__tool" data-reveal="tool">
                  <span class="claude-terminal__tool-label">Read</span>
                  <span class="claude-terminal__tool-target">23 campaigns · 89 ad groups · 156 RSAs</span>
                </div>
                <p class="claude-terminal__response-text" data-reveal="text">Found 4 campaigns missing sitelinks, 3 callout gaps, and 2 campaigns need structured snippets.</p>
              </div>
            </div>

            <!-- Beat 3: The Decision -->
            <div class="claude-terminal__message claude-terminal__message--user" data-beat="3">
              <span class="claude-terminal__prompt">›</span>
              <span class="claude-terminal__text" data-typewriter>Fix them</span>
            </div>

            <!-- Thinking indicator before action -->
            <div class="claude-terminal__thinking" data-thinking="2" aria-live="polite">
              <span class="claude-terminal__thinking-spinner"></span>
              <span class="claude-terminal__thinking-text">Writing</span>
            </div>

            <!-- Beat 4: The Action -->
            <div class="claude-terminal__message claude-terminal__message--claude" data-beat="4">
              <div class="claude-terminal__claude-indicator" data-reveal="indicator">
                <span class="claude-terminal__claude-icon">●</span>
                <span class="claude-terminal__claude-name">Claude</span>
              </div>
              <div class="claude-terminal__response">
                <p class="claude-terminal__response-text" data-reveal="text">Adding the missing extensions now.</p>
                <div class="claude-terminal__tool claude-terminal__tool--write" data-reveal="tool">
                  <span class="claude-terminal__tool-label">Write</span>
                  <span class="claude-terminal__tool-target">4 sitelinks · 3 callouts · 2 structured snippets</span>
                </div>
              </div>
            </div>

            <!-- Thinking indicator before consecutive Claude message -->
            <div class="claude-terminal__thinking" data-thinking="4" aria-live="polite">
              <span class="claude-terminal__thinking-spinner"></span>
              <span class="claude-terminal__thinking-text">Thinking</span>
            </div>

            <!-- Beat 5: The Payoff -->
            <div class="claude-terminal__message claude-terminal__message--claude claude-terminal__message--final" data-beat="5">
              <div class="claude-terminal__response">
                <p class="claude-terminal__response-text claude-terminal__response-text--success" data-reveal="text">Done. All extensions live. Your accounts are compliant.</p>
              </div>
            </div>
          </div>
          <!-- Fade overlay for cliffhanger effect -->
          <div class="claude-terminal__fade" aria-hidden="true"></div>
        </div>
        <p class="hero__terminal-caption" data-animate="fade-up" data-stagger="2">Audits, extensions, RSAs—describe what you need. Claude handles the rest.</p>
      </header>

      <!-- CTA: Inline, reserved -->
      <div class="cta cta--inline" data-animate="fade-up" data-stagger="3">
        <p class="cta__text">Free and open source.</p>
        <EmailSignup placeholder="your@email.com" tag="hero" />
        <p class="cta__hint">Requires Claude Pro (~$20/mo)</p>
      </div>

      <!-- Origin: Dense story block -->
      <section class="story story--origin" data-animate="fade-up" data-stagger="4">
        <p class="story__lede">
          A year ago I lived inside the Google Ads UI. Twenty-five accounts. Hundreds of campaigns. The same checks, over and over.
        </p>
        <p>
          Then I started experimenting with Claude. Not for ads at first. I was curious. I asked it to pull some data. It wrote a script. I asked for another. That worked too.
        </p>
        <p class="story__pull">
          I kept asking. It kept building.
        </p>
        <p>
          Somewhere along the way I stopped thinking of Claude as a tool and started thinking of it as the developer I could never afford. One who writes thousands of lines while I describe what I need in plain English.
        </p>
        <p>
          Now my workflow lives in the terminal. That probably sounds intimidating. It's not. It's a text window. You type what you want. Claude does the rest.
        </p>
        <p>
          An open source Claude Code plugin for Google Ads. It lets Claude work directly with your ad accounts—audits, edits, reports. I'm shipping new features constantly.
        </p>
        <p>
          Built for media buyers. Free forever. You just need Claude Pro (~$20/mo).
        </p>
      </section>

      <section class="faq" data-animate="fade-up" data-stagger="4">
        <div class="faq__item">
          <h3 class="faq__question">How does it work?</h3>
          <p class="faq__answer">
            Everything runs on your machine. You use your own Claude Pro subscription and connect your own Google Ads API credentials. Nothing passes through my servers—I never see your data or account access.
          </p>
        </div>
        <div class="faq__item">
          <h3 class="faq__question">Why free?</h3>
          <p class="faq__answer">
            I don't need your money. I need your feedback. Use the plugin. Break it. Tell me what's broken. That's the deal.
          </p>
        </div>
        <div class="faq__item">
          <h3 class="faq__question">What about my accounts?</h3>
          <p class="faq__answer">
            The plugin can read and modify your data, but only when you ask. Claude shows you what it's about to do and waits for approval. You stay in control.
          </p>
        </div>
      </section>

      <!-- The Belief: Tightened worldview statement -->
      <section class="story story--belief" data-animate="fade-up" data-stagger="4">
        <p class="story__manifesto">
          Intelligence is becoming a commodity. What matters now is the workflows—the patterns that produce results.
        </p>
        <p>
          If you can describe what you want in a sentence, you can use this.
        </p>
      </section>

      <!-- Final CTA: Value exchange -->
      <section class="invitation" data-animate="fade-up" data-stagger="5">
        <div class="invitation__content">
          <h2 class="invitation__headline">Start prompting in 15 minutes</h2>
          <p class="invitation__description">
            Works with your existing Google Ads MCC and developer token. One walkthrough to connect—then let Claude handle the rest.
          </p>
          <div class="invitation__form">
            <EmailSignup placeholder="your@email.com" tag="setup-guide" />
          </div>
          <p class="invitation__cadence">
            Plus: new features and workflow ideas as I build. No courses. No pitch decks.
          </p>
        </div>
      </section>

      <!-- Footer: Minimal, breathing -->
      <footer class="page-footer" data-animate="fade-up" data-stagger="5">
        <div class="page-footer__left">
          <div class="page-footer__logo">
            <LogoAnimated delay={200} />
          </div>
          <p class="page-footer__attribution">
            Built by <AnimatedName alias="ctrlswing" realName="Jackson" />
          </p>
        </div>
        <div class="page-footer__social">
          <SocialLinks />
        </div>
      </footer>
    </Prose>
  </main>
</BaseLayout>

<style>
  /* =========================================
   * PAGE LAYOUT
   * Full viewport, generous whitespace
   * ========================================= */
  .page {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    min-height: 100vh;
    min-height: 100dvh;
    padding-block-start: max(var(--space-12), env(safe-area-inset-top, 0px) + var(--space-6));
    padding-block-end: max(var(--space-16), env(safe-area-inset-bottom, 0px) + var(--space-10));
    position: relative;
    isolation: isolate;
  }

  @media (min-width: 480px) {
    .page {
      padding-block-start: var(--space-16);
      padding-block-end: var(--space-20);
    }
  }

  @media (min-width: 768px) {
    .page {
      padding-block-start: var(--space-20);
      padding-block-end: var(--space-24);
    }
  }

  @media (min-width: 1024px) {
    .page {
      padding-block-start: var(--space-24);
    }
  }

  @media (min-height: 800px) {
    .page {
      padding-block-start: 8vh;
    }
  }

  /* =========================================
   * ATMOSPHERE
   * Subtle orb effect - positioned behind terminal
   * ========================================= */
  .atmosphere {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    overflow: hidden;
  }

  .atmosphere__orb {
    position: absolute;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    width: min(750px, 110vw);
    height: min(550px, 75vh);
    background: radial-gradient(
      ellipse 100% 100% at 50% 30%,
      var(--color-accent-glow) 0%,
      oklch(18% 0.02 35 / 0.08) 40%,
      transparent 70%
    );
    filter: blur(80px);
    animation: orb-drift 25s var(--ease-in-out) infinite;
  }

  @keyframes orb-drift {
    0%, 100% {
      opacity: 0.2;
      transform: translateX(-50%) translateY(0);
    }
    50% {
      opacity: 0.35;
      transform: translateX(-50%) translateY(-15px);
    }
  }

  /* =========================================
   * HERO
   * Unified typography: serif headlines, muted second line
   * ========================================= */
  .hero {
    text-align: left;
    margin-bottom: var(--space-12);
  }

  @media (min-width: 768px) {
    .hero {
      margin-bottom: var(--space-16);
    }
  }

  .hero__overline {
    font-family: var(--font-sans);
    font-size: var(--text-2xs);
    font-weight: var(--font-semibold);
    letter-spacing: var(--tracking-wider);
    text-transform: uppercase;
    color: var(--color-accent);
    margin: 0 0 var(--space-4) 0;
    opacity: 0.85;
  }

  @media (min-width: 768px) {
    .hero__overline {
      font-size: var(--text-xs);
      margin-bottom: var(--space-5);
    }
  }

  /* Headline - clean serif, reduced color variation */
  .hero__headline {
    font-family: var(--font-serif);
    font-size: clamp(1.875rem, 8vw, 2.75rem);
    font-weight: var(--font-bold);
    letter-spacing: -0.025em;
    line-height: 1.08;
    color: var(--color-fg);
    margin: 0 0 var(--space-10) 0;
    max-width: 20ch;
  }

  .hero__headline-break {
    display: block;
    color: var(--color-fg-secondary);
    margin-top: 0.12em;
  }

  @media (min-width: 480px) {
    .hero__headline {
      font-size: clamp(2.25rem, 7vw, 3.5rem);
      margin-bottom: var(--space-12);
    }
  }

  @media (min-width: 768px) {
    .hero__headline {
      font-size: clamp(3rem, 5.5vw, 5rem);
      letter-spacing: -0.03em;
      line-height: 1.05;
      margin-bottom: var(--space-14);
    }
  }

  .hero__terminal-caption {
    font-family: var(--font-serif);
    font-size: var(--text-sm);
    font-style: italic;
    color: var(--color-fg-muted);
    margin: var(--space-4) 0 0 0;
    max-width: 48ch;
  }

  @media (min-width: 768px) {
    .hero__terminal-caption {
      font-size: var(--text-base);
      margin-top: var(--space-5);
    }
  }

  /* =========================================
   * CLAUDE CODE TERMINAL
   * Authentic conversational interface with scroll
   * ========================================= */
  .claude-terminal {
    max-width: 100%;
    background: var(--color-bg-deep);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    box-shadow:
      0 4px 24px oklch(0% 0 0 / 0.4),
      0 0 0 1px oklch(100% 0 0 / 0.02) inset,
      0 1px 0 0 oklch(100% 0 0 / 0.04) inset;
    position: relative;
  }

  @media (min-width: 768px) {
    .claude-terminal {
      font-size: var(--text-sm);
      max-width: 680px;
    }
  }

  /* Bottom fade overlay for depth */
  .claude-terminal__fade {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      var(--color-bg-deep) 100%
    );
    pointer-events: none;
    z-index: 2;
    opacity: 0;
    transition: opacity 0.3s ease-out;
    transition-delay: 100ms; /* Smoother appearance */
  }

  /* Show fade when content is scrollable */
  .claude-terminal.has-overflow .claude-terminal__fade {
    opacity: 1;
  }

  /* Hide fade when scrolled to bottom */
  .claude-terminal.at-bottom .claude-terminal__fade {
    opacity: 0;
  }

  /* Chrome bar */
  .claude-terminal__chrome {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2) var(--space-3);
    background: var(--color-bg-elevated);
    border-bottom: 1px solid var(--color-border-subtle);
  }

  .claude-terminal__dots {
    display: flex;
    gap: 5px;
  }

  .claude-terminal__dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .claude-terminal__dots span:nth-child(1) {
    background: #ff5f57;
  }

  .claude-terminal__dots span:nth-child(2) {
    background: #ffbd2e;
  }

  .claude-terminal__dots span:nth-child(3) {
    background: #28c840;
  }

  .claude-terminal__title {
    font-size: var(--text-xs);
    color: var(--color-fg-subtle);
    letter-spacing: 0.02em;
  }

  /* Content area - fixed height with scroll */
  .claude-terminal__content {
    padding: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    min-height: 200px;  /* Maintain consistent height during animation */
    max-height: 240px;
    overflow-y: auto;
    /* scroll-behavior handled by JS for better control */

    /* Custom scrollbar */
    scrollbar-width: thin;
    scrollbar-color: var(--color-border) transparent;
  }

  .claude-terminal__content::-webkit-scrollbar {
    width: 6px;
  }

  .claude-terminal__content::-webkit-scrollbar-track {
    background: transparent;
  }

  .claude-terminal__content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 3px;
  }

  .claude-terminal__content::-webkit-scrollbar-thumb:hover {
    background: var(--color-border-subtle);
  }

  @media (min-width: 480px) {
    .claude-terminal__content {
      padding: var(--space-5);
      gap: var(--space-4);
      min-height: 220px;
      max-height: 260px;
    }
  }

  @media (min-width: 768px) {
    .claude-terminal__content {
      padding: var(--space-6);
      gap: var(--space-5);
      min-height: 240px;
      max-height: 300px;
    }
  }

  /* Messages */
  .claude-terminal__message {
    display: flex;
    gap: var(--space-2);
  }

  .claude-terminal__message--user {
    align-items: flex-start;
  }

  .claude-terminal__message--claude {
    flex-direction: column;
    gap: var(--space-2);
  }

  /* User prompt */
  .claude-terminal__prompt {
    color: var(--color-accent);
    font-weight: var(--font-medium);
    flex-shrink: 0;
    user-select: none;
  }

  .claude-terminal__text {
    color: var(--color-fg);
    line-height: var(--leading-relaxed);
  }

  /* Claude indicator */
  .claude-terminal__claude-indicator {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .claude-terminal__claude-icon {
    color: var(--color-accent);
    font-size: 0.6em;
  }

  .claude-terminal__claude-name {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--color-fg-muted);
    letter-spacing: 0.01em;
  }

  /* Claude response */
  .claude-terminal__response {
    padding-left: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .claude-terminal__response-text {
    color: var(--color-fg-secondary);
    line-height: var(--leading-relaxed);
    margin: 0;
    font-size: 0.95em;
  }

  /* Tool indicators */
  .claude-terminal__tool {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-1) var(--space-2);
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    width: fit-content;
  }

  .claude-terminal__tool-label {
    font-size: 0.85em;
    font-weight: var(--font-semibold);
    color: var(--color-fg-muted);
  }

  .claude-terminal__tool-target {
    font-size: 0.85em;
    color: var(--color-fg-subtle);
  }

  .claude-terminal__tool--success .claude-terminal__tool-label {
    color: var(--color-accent);
  }

  /* Write tool variant - subtle differentiation */
  .claude-terminal__tool--write .claude-terminal__tool-label {
    color: var(--color-accent);
  }

  /* Success/final message styling */
  .claude-terminal__response-text--success {
    color: var(--color-fg) !important;
    font-weight: var(--font-medium);
  }

  /* =========================================
   * THINKING INDICATOR
   * Cycles through action words like Claude Code
   * ========================================= */
  .claude-terminal__thinking {
    display: none;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-1) 0;
    opacity: 0;
  }

  .claude-terminal__thinking.is-active {
    display: flex;
    animation: thinking-fade-in 0.2s ease-out forwards;
  }

  @keyframes thinking-fade-in {
    from {
      opacity: 0;
      transform: translateY(4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .claude-terminal__thinking-spinner {
    width: 12px;
    height: 12px;
    border: 2px solid var(--color-border);
    border-top-color: var(--color-accent);
    border-radius: 50%;
    animation: thinking-spin 0.8s linear infinite;
  }

  @keyframes thinking-spin {
    to {
      transform: rotate(360deg);
    }
  }

  .claude-terminal__thinking-text {
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    font-style: italic;
    letter-spacing: 0.01em;
  }

  /* Ellipsis animation for thinking text */
  .claude-terminal__thinking-text::after {
    content: '';
    animation: thinking-ellipsis 1.5s steps(4, end) infinite;
  }

  @keyframes thinking-ellipsis {
    0% { content: ''; }
    25% { content: '.'; }
    50% { content: '..'; }
    75% { content: '...'; }
    100% { content: ''; }
  }

  /* Fade out animation for thinking indicator */
  .claude-terminal__thinking.is-fading {
    animation: thinking-fade-out 250ms var(--ease-out, cubic-bezier(0, 0, 0.2, 1)) forwards;
  }

  @keyframes thinking-fade-out {
    to {
      opacity: 0;
      transform: translateY(-4px);
    }
  }

  /* =========================================
   * TERMINAL ANIMATION STATES
   * Progressive reveal system
   *
   * Flow:
   * 1. Terminal content hidden by default (no flash)
   * 2. Terminal fades in via page animation
   * 3. JS marks ready, beats animate in sequence
   * ========================================= */

  /* Hide all beats by default - prevents flash before JS */
  .claude-terminal[data-terminal-animate] [data-beat] {
    opacity: 0;
    transform: translateY(12px);
    visibility: hidden;
    pointer-events: none;
  }

  /* Hide thinking indicators by default */
  .claude-terminal[data-terminal-animate] .claude-terminal__thinking {
    display: none;
  }

  /* Revealed beats - fade up smoothly */
  .claude-terminal[data-terminal-animate] [data-beat].is-revealed {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
    pointer-events: auto;
    transition:
      opacity 0.5s var(--ease-snap),
      transform 0.5s var(--ease-snap),
      visibility 0s;
  }

  /* Elements within beats - hidden until parent reveals */
  .claude-terminal[data-terminal-animate] [data-reveal] {
    opacity: 0;
    transform: translateY(6px);
  }

  .claude-terminal[data-terminal-animate] [data-reveal].is-revealed {
    opacity: 1;
    transform: translateY(0);
    transition:
      opacity 0.3s var(--ease-snap),
      transform 0.3s var(--ease-snap);
  }

  /* Tool call - special scale-up entrance */
  .claude-terminal[data-terminal-animate] [data-reveal="tool"] {
    transform: translateY(6px) scale(0.95);
  }

  .claude-terminal[data-terminal-animate] [data-reveal="tool"].is-revealed {
    transform: translateY(0) scale(1);
    transition:
      opacity 0.35s var(--ease-snap),
      transform 0.35s var(--ease-pop);
  }

  /* Typewriter text - container visible, text added by JS */
  .claude-terminal[data-terminal-animate] [data-typewriter] {
    opacity: 1;
  }

  /* Typewriter cursor */
  .claude-terminal__cursor {
    display: inline-block;
    width: 2px;
    height: 1.1em;
    background: var(--color-accent);
    margin-left: 1px;
    vertical-align: text-bottom;
    animation: cursor-blink 0.6s ease-in-out infinite;
  }

  .claude-terminal__cursor--hidden {
    opacity: 0;
    transition: opacity 0.15s ease-out;
  }

  @keyframes cursor-blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Prompt symbol - pulses when typing completes */
  .claude-terminal__prompt.is-complete {
    animation: prompt-pulse 0.3s ease-out;
  }

  @keyframes prompt-pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }

  /* Final message - subtle glow on reveal */
  .claude-terminal__message--final.is-revealed .claude-terminal__response-text--success {
    animation: success-glow 0.8s var(--ease-out);
  }

  @keyframes success-glow {
    0% {
      text-shadow: 0 0 0 transparent;
    }
    40% {
      text-shadow: var(--text-glow-medium);
    }
    100% {
      text-shadow: 0 0 0 transparent;
    }
  }

  /* No-JS fallback: show static content after brief delay
     This only applies if JS never runs */
  @supports (animation-timeline: auto) {
    .claude-terminal[data-terminal-animate]:not([data-animation-ready]) [data-beat] {
      animation: nojs-reveal 0.01ms 2s forwards;
    }
  }

  @keyframes nojs-reveal {
    to {
      opacity: 1;
      transform: none;
      visibility: visible;
    }
  }

  /* Reduced motion - show everything immediately */
  @media (prefers-reduced-motion: reduce) {
    .claude-terminal[data-terminal-animate] [data-beat],
    .claude-terminal[data-terminal-animate] [data-reveal] {
      opacity: 1 !important;
      transform: none !important;
      visibility: visible !important;
      pointer-events: auto !important;
      transition: none !important;
    }

    .claude-terminal[data-terminal-animate] .claude-terminal__thinking {
      display: none !important;
    }

    .claude-terminal__cursor {
      animation: none;
      opacity: 0;
    }

    .claude-terminal__message--final.is-revealed .claude-terminal__response-text--success {
      animation: none;
    }
  }

  /* =========================================
   * INLINE CTA
   * Reserved, inline with content
   * ========================================= */
  .cta--inline {
    margin-bottom: var(--space-16);
    max-width: 360px;
  }

  @media (min-width: 768px) {
    .cta--inline {
      margin-bottom: var(--space-20);
    }
  }

  .cta__text {
    font-family: var(--font-serif);
    font-size: var(--fluid-md);
    color: var(--color-fg);
    margin: 0 0 var(--space-5) 0;
  }

  @media (min-width: 768px) {
    .cta__text {
      font-size: var(--fluid-lg);
      margin-bottom: var(--space-6);
    }
  }

  .cta__hint {
    font-family: var(--font-sans);
    font-size: var(--text-xs);
    color: var(--color-fg-subtle);
    margin: var(--space-4) 0 0 0;
  }

  /* =========================================
   * STORY SECTIONS
   * Unified serif typography
   * ========================================= */
  .story {
    max-width: var(--measure-prose);
  }

  .story p {
    font-family: var(--font-serif);
    font-size: var(--type-prose-size);
    line-height: var(--leading-relaxed);
    color: var(--color-fg-secondary);
    margin: 0 0 var(--space-6) 0;
  }

  .story p:last-child {
    margin-bottom: 0;
  }

  @media (min-width: 768px) {
    .story p {
      font-size: var(--fluid-lg);
      line-height: var(--leading-prose);
      margin-bottom: var(--space-7);
    }
  }

  /* Origin: Dense, narrative block */
  .story--origin {
    margin-bottom: var(--space-10);
  }

  @media (min-width: 768px) {
    .story--origin {
      margin-bottom: var(--space-14);
    }
  }

  .story__lede {
    font-size: var(--fluid-lg) !important;
    color: var(--color-fg) !important;
    font-weight: var(--font-medium);
    margin-bottom: var(--space-8) !important;
  }

  @media (min-width: 768px) {
    .story__lede {
      font-size: var(--fluid-xl) !important;
      margin-bottom: var(--space-10) !important;
    }
  }

  .story__pull {
    font-size: var(--fluid-lg) !important;
    font-weight: var(--font-semibold);
    color: var(--color-fg) !important;
    padding: var(--space-6) 0 var(--space-6) var(--space-5);
    margin: var(--space-8) 0 var(--space-10) 0 !important;
    border-left: 3px solid var(--color-accent);
    border-top: none;
    border-bottom: none;
    background: linear-gradient(
      90deg,
      var(--color-accent-subtle) 0%,
      transparent 100%
    );
  }

  @media (min-width: 768px) {
    .story__pull {
      font-size: var(--fluid-2xl) !important;
      padding: var(--space-8) 0 var(--space-8) var(--space-7);
      margin: var(--space-10) 0 var(--space-12) 0 !important;
    }
  }

  /* Belief section: Manifesto tone */
  .story--belief {
    padding: var(--space-12) 0;
    margin-top: var(--space-10);
    border-top: 1px solid var(--color-border-subtle);
  }

  @media (min-width: 768px) {
    .story--belief {
      padding: var(--space-16) 0;
      margin-top: var(--space-14);
    }
  }

  .story__manifesto {
    font-size: var(--fluid-lg) !important;
    font-weight: var(--font-semibold);
    color: var(--color-fg) !important;
    line-height: var(--leading-snug) !important;
    margin-bottom: var(--space-5) !important;
  }

  @media (min-width: 768px) {
    .story__manifesto {
      font-size: var(--fluid-xl) !important;
      margin-bottom: var(--space-6) !important;
    }
  }


  /* =========================================
   * FAQ SECTION
   * Compact Q&A pairs with clear grouping
   * ========================================= */
  .faq {
    display: flex;
    flex-direction: column;
    gap: var(--space-10);
    max-width: var(--measure-prose);
    padding-top: var(--space-8);
  }

  @media (min-width: 768px) {
    .faq {
      gap: var(--space-12);
      padding-top: var(--space-10);
    }
  }

  .faq__item {
    /* Consistent border treatment across breakpoints */
    padding-bottom: var(--space-8);
    border-bottom: 1px solid var(--color-border-subtle);
  }

  .faq__item:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }

  @media (min-width: 768px) {
    .faq__item {
      padding-bottom: var(--space-10);
    }

    .faq__item:last-child {
      padding-bottom: 0;
    }
  }

  .faq__question {
    font-family: var(--font-serif);
    font-size: var(--fluid-md);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin: 0 0 var(--space-3) 0;
  }

  @media (min-width: 768px) {
    .faq__question {
      font-size: var(--fluid-lg);
      margin-bottom: var(--space-4);
    }
  }

  .faq__answer {
    font-family: var(--font-serif);
    font-size: var(--type-prose-size);
    line-height: var(--leading-relaxed);
    color: var(--color-fg-secondary);
    margin: 0;
  }

  @media (min-width: 768px) {
    .faq__answer {
      font-size: var(--fluid-md);
      line-height: var(--leading-prose);
    }
  }

  /* =========================================
   * INVITATION
   * Simple, clean - no card treatment
   * ========================================= */
  .invitation {
    margin-top: var(--space-20);
  }

  @media (min-width: 768px) {
    .invitation {
      margin-top: var(--space-28);
    }
  }

  .invitation__content {
    max-width: var(--measure-prose);
  }

  .invitation__headline {
    font-family: var(--font-serif);
    font-size: var(--fluid-2xl);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin: 0 0 var(--space-6) 0;
  }

  @media (min-width: 768px) {
    .invitation__headline {
      font-size: var(--fluid-3xl);
      margin-bottom: var(--space-7);
    }
  }

  .invitation__description {
    font-family: var(--font-serif);
    font-size: var(--fluid-md);
    line-height: var(--leading-relaxed);
    color: var(--color-fg-secondary);
    margin: 0 0 var(--space-8) 0;
  }

  @media (min-width: 768px) {
    .invitation__description {
      font-size: var(--fluid-lg);
      line-height: var(--leading-prose);
      margin-bottom: var(--space-10);
    }
  }

  .invitation__form {
    margin-bottom: var(--space-5);
    max-width: 340px;
  }

  .invitation__cadence {
    font-family: var(--font-sans);
    font-size: var(--text-xs);
    color: var(--color-fg-subtle);
    margin: 0;
    line-height: var(--leading-relaxed);
  }

  /* =========================================
   * FOOTER
   * Minimal, lots of breathing room
   * ========================================= */
  .page-footer {
    margin-top: var(--space-28);
    padding-top: var(--space-12);
    border-top: 1px solid var(--color-border-subtle);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-8);
  }

  @media (min-width: 768px) {
    .page-footer {
      margin-top: var(--space-36);
      padding-top: var(--space-14);
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-10);
    }
  }

  @media (min-width: 1024px) {
    .page-footer {
      margin-top: var(--space-40);
      padding-top: var(--space-16);
    }
  }

  .page-footer__left {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
  }

  @media (min-width: 768px) {
    .page-footer__left {
      flex-direction: row;
      align-items: center;
      gap: var(--space-8);
    }
  }

  /* Footer opacity scale: visible but quiet */
  .page-footer__logo {
    opacity: 0.7;
    transition: opacity var(--duration-normal) var(--ease-out);
  }

  .page-footer__logo:hover {
    opacity: 1;
  }

  .page-footer__attribution {
    font-family: var(--font-sans);
    font-size: var(--text-xs);
    color: var(--color-fg-subtle);
    margin: 0;
    opacity: 0.8;
    transition: opacity var(--duration-normal) var(--ease-out);
  }

  .page-footer__attribution:hover {
    opacity: 1;
  }

  .page-footer__social {
    opacity: 0.5;
    transition: opacity var(--duration-normal) var(--ease-out);
  }

  .page-footer__social:hover {
    opacity: 0.8;
  }

  /* =========================================
   * PAGE ENTRY ANIMATIONS
   * Orchestrated staggered reveal on load
   * ========================================= */
  [data-animate] {
    opacity: 0;
    animation-fill-mode: both;
  }

  /* Fade up - the workhorse entrance */
  [data-animate="fade-up"] {
    animation: page-fade-up 0.6s var(--ease-snap) both;
  }

  /* Blur in - premium hero effect */
  [data-animate="blur-in"] {
    animation: page-blur-in 0.8s var(--ease-snap) both;
  }

  @keyframes page-fade-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes page-blur-in {
    from {
      opacity: 0;
      transform: translateY(16px);
      filter: blur(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }
  }

  /* Stagger delays - orchestrated timing */
  [data-stagger="1"] { animation-delay: 0ms; }
  [data-stagger="2"] { animation-delay: 100ms; }
  [data-stagger="3"] { animation-delay: 200ms; }
  [data-stagger="4"] { animation-delay: 300ms; }
  [data-stagger="5"] { animation-delay: 400ms; }

  /* =========================================
   * SCROLL-TRIGGERED REVEALS
   * Elements fade in as they enter viewport
   * ========================================= */
  .story,
  .faq,
  .invitation {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.7s var(--ease-snap),
      transform 0.7s var(--ease-snap);
  }

  .story.is-visible,
  .faq.is-visible,
  .invitation.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* FAQ items stagger within section */
  .faq:not(.is-visible) .faq__item {
    opacity: 0;
    transform: translateY(20px);
  }

  .faq__item {
    transition:
      opacity 0.6s var(--ease-snap),
      transform 0.6s var(--ease-snap),
      padding-left 0.25s var(--ease-out);
  }

  .faq.is-visible .faq__item {
    opacity: 1;
    transform: translateY(0);
  }

  .faq.is-visible .faq__item:nth-child(1) { transition-delay: 0ms; }
  .faq.is-visible .faq__item:nth-child(2) { transition-delay: 100ms; }
  .faq.is-visible .faq__item:nth-child(3) { transition-delay: 200ms; }

  /* =========================================
   * TERMINAL HOVER ENHANCEMENTS
   * Premium lift + glow on hover
   * ========================================= */
  .claude-terminal {
    transition:
      transform 0.4s var(--ease-snap),
      box-shadow 0.4s var(--ease-out);
  }

  .claude-terminal:hover {
    transform: translateY(-2px);
    box-shadow:
      0 8px 32px oklch(0% 0 0 / 0.5),
      0 0 0 1px oklch(100% 0 0 / 0.03) inset,
      0 1px 0 0 oklch(100% 0 0 / 0.05) inset,
      0 0 40px var(--color-accent-glow);
  }

  /* Terminal dots subtle pulse on hover */
  .claude-terminal:hover .claude-terminal__dots span {
    animation: dot-pulse 1.5s ease-in-out infinite;
  }

  .claude-terminal:hover .claude-terminal__dots span:nth-child(2) {
    animation-delay: 0.15s;
  }

  .claude-terminal:hover .claude-terminal__dots span:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes dot-pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(0.95); }
  }

  /* =========================================
   * FAQ HOVER AFFORDANCE
   * Subtle left border reveal on hover
   * ========================================= */
  .faq__item {
    position: relative;
    padding-left: var(--space-5);
  }

  @media (min-width: 768px) {
    .faq__item {
      padding-left: var(--space-6);
    }
  }

  .faq__item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: calc(100% - var(--space-8));
    width: 2px;
    background: var(--color-accent);
    transform: scaleY(0);
    transform-origin: top;
    transition: transform 0.3s var(--ease-snap);
    border-radius: 1px;
  }

  @media (min-width: 768px) {
    .faq__item::before {
      height: calc(100% - var(--space-10));
    }
  }

  .faq__item:last-child::before {
    height: 100%;
  }

  .faq__item:hover::before {
    transform: scaleY(1);
  }

  .faq__item:hover {
    padding-left: var(--space-6);
  }

  @media (min-width: 768px) {
    .faq__item:hover {
      padding-left: var(--space-7);
    }
  }

  .faq__question {
    transition: color 0.2s var(--ease-out);
  }

  .faq__item:hover .faq__question {
    color: var(--color-accent);
  }

  /* =========================================
   * INVITATION SECTION POLISH
   * Subtle border animation on scroll reveal
   * ========================================= */
  .invitation__content {
    position: relative;
  }

  .invitation__headline {
    position: relative;
    display: inline-block;
  }

  /* Underline draw effect on reveal */
  .invitation__headline::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -4px;
    width: 100%;
    height: 2px;
    background: linear-gradient(
      90deg,
      var(--color-accent) 0%,
      var(--color-gold) 100%
    );
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.6s var(--ease-snap);
    transition-delay: 0.3s;
  }

  .invitation.is-visible .invitation__headline::after {
    transform: scaleX(1);
  }

  /* =========================================
   * STORY PULL QUOTE ENHANCEMENT
   * Left border accent with gradient
   * ========================================= */
  .story__pull {
    position: relative;
    border-radius: var(--radius-sm);
  }

  /* =========================================
   * ATMOSPHERE PARALLAX
   * Subtle parallax on scroll
   * ========================================= */
  .atmosphere__orb {
    will-change: transform;
  }

  /* =========================================
   * CTA FORM MICRO-INTERACTIONS
   * ========================================= */
  .cta--inline,
  .invitation__form {
    transition: transform 0.3s var(--ease-out);
  }

  .cta--inline:focus-within,
  .invitation__form:focus-within {
    transform: translateY(-2px);
  }

  /* =========================================
   * REDUCED MOTION
   * ========================================= */
  @media (prefers-reduced-motion: reduce) {
    .atmosphere__orb {
      animation: none;
      opacity: 0.2;
    }

    [data-animate] {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
      filter: none !important;
    }

    .story,
    .faq,
    .invitation,
    .faq__item {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }

    .claude-terminal {
      transition: none !important;
    }

    .claude-terminal:hover {
      transform: none;
    }

    .faq__item::before,
    .invitation__headline::after {
      transition: none !important;
      transform: scaleX(1) !important;
    }

    .claude-terminal:hover .claude-terminal__dots span {
      animation: none;
    }
  }
</style>

<script>
  /**
   * Terminal Animation Orchestrator
   *
   * Creates an authentic Claude Code experience with:
   * - Realistic human typing speed (~65 WPM)
   * - "Thinking" indicator with cycling action words
   * - Proper pauses reflecting real LLM response times
   * - Auto-scroll as content grows
   *
   * Timing grounded in research:
   * - Human typing: 40-75 WPM avg (WordsRated 2024)
   * - Claude first token latency: 0.7-2s (AI benchmarks)
   * - Claude output: ~70 tokens/sec streaming
   */

  function initTerminalAnimation() {
    const terminal = document.querySelector('[data-terminal-animate]') as HTMLElement | null;
    if (!terminal || terminal.hasAttribute('data-animation-initialized')) return;

    terminal.setAttribute('data-animation-initialized', 'true');
    terminal.setAttribute('data-animation-ready', 'true'); // Signals CSS that JS is in control

    const contentArea = terminal.querySelector('.claude-terminal__content') as HTMLElement | null;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) {
      terminal.querySelectorAll('[data-beat], [data-reveal]').forEach(el => {
        el.classList.add('is-revealed');
      });
      return;
    }

    // Timing configuration grounded in real-world data
    const TIMING = {
      // User typing: ~65 WPM = ~5.4 chars/sec = ~185ms/char
      // Slightly faster for snappier feel
      typewriterSpeed: 55,
      typewriterVariance: 25,      // ±25ms randomness
      typewriterPunctuationPause: 100,
      typewriterStartDelay: 400,   // Enough for cursor to blink once
      cursorLingerTime: 200,

      // Thinking indicator - balanced pacing
      thinkingMinDuration: 1400,
      thinkingWordInterval: 1000,
      thinkingFadeOutDuration: 200,

      // Claude responses - snappy but readable
      claudeResponseDelay: 300,
      revealStagger: 200,
      toolRevealDelay: 350,
      postToolPause: 600,

      // Beat gaps - tighter for better flow
      beatGap: 500,
      finalBeatGap: 400,

      // Wait for terminal's page entry animation (stagger-2 = 100ms + 600ms animation)
      pageEntryWait: 800,
    };

    // Simplified action words - focused and context-appropriate
    const THINKING_WORDS = ['Thinking', 'Analyzing', 'Reviewing'];
    const WRITING_WORDS = ['Writing', 'Updating'];

    // Get all beats in order
    const beats = Array.from(terminal.querySelectorAll('[data-beat]'))
      .sort((a, b) => {
        const aNum = parseInt(a.getAttribute('data-beat') || '0', 10);
        const bNum = parseInt(b.getAttribute('data-beat') || '0', 10);
        return aNum - bNum;
      });

    // Debounced scroll - prevents jitter from rapid calls during typewriter
    let scrollTimeout: number | null = null;
    let lastScrollTarget = 0;

    function scrollToElement(element: Element, immediate = false) {
      if (!contentArea) return;

      const elementRect = element.getBoundingClientRect();
      const contentRect = contentArea.getBoundingClientRect();
      const elementBottom = elementRect.bottom - contentRect.top + contentArea.scrollTop;
      const visibleBottom = contentArea.scrollTop + contentArea.clientHeight;

      // Only scroll if element is below visible area
      if (elementBottom <= visibleBottom - 20) return;

      const targetScroll = elementBottom - contentArea.clientHeight + 40;
      const scrollDelta = Math.abs(targetScroll - contentArea.scrollTop);

      // Large jumps (>50px) use instant scroll, small use smooth
      const behavior = scrollDelta > 50 ? 'instant' : 'smooth';

      if (immediate) {
        contentArea.scrollTo({ top: targetScroll, behavior: behavior as ScrollBehavior });
        lastScrollTarget = targetScroll;
        return;
      }

      // Debounce rapid calls (50ms) - good for typewriter
      if (scrollTimeout !== null) {
        clearTimeout(scrollTimeout);
      }

      lastScrollTarget = targetScroll;
      scrollTimeout = window.setTimeout(() => {
        contentArea.scrollTo({ top: lastScrollTarget, behavior: behavior as ScrollBehavior });
        scrollTimeout = null;
      }, 50);
    }

    // Check and update overflow state for fade effect
    function updateOverflowState() {
      if (!contentArea) return;
      const hasOverflow = contentArea.scrollHeight > contentArea.clientHeight;
      const atBottom = contentArea.scrollTop + contentArea.clientHeight >= contentArea.scrollHeight - 10;

      terminal.classList.toggle('has-overflow', hasOverflow);
      terminal.classList.toggle('at-bottom', atBottom);
    }

    // Show thinking indicator with cycling words and fade-out
    function showThinking(thinkingId: string, words: string[]): { stop: () => Promise<void> } {
      const thinkingEl = terminal.querySelector(`[data-thinking="${thinkingId}"]`) as HTMLElement | null;
      if (!thinkingEl) return { stop: () => Promise.resolve() };

      const textEl = thinkingEl.querySelector('.claude-terminal__thinking-text');
      let wordIndex = 0;
      let intervalId: number;

      thinkingEl.classList.add('is-active');
      scrollToElement(thinkingEl, true);

      // Cycle through words at slower pace
      intervalId = window.setInterval(() => {
        wordIndex = (wordIndex + 1) % words.length;
        if (textEl) textEl.textContent = words[wordIndex];
      }, TIMING.thinkingWordInterval);

      return {
        stop: () => {
          clearInterval(intervalId);
          // Fade out gracefully
          thinkingEl.classList.add('is-fading');
          return new Promise<void>((resolve) => {
            setTimeout(() => {
              thinkingEl.classList.remove('is-active', 'is-fading');
              resolve();
            }, TIMING.thinkingFadeOutDuration);
          });
        }
      };
    }

    // Typewriter effect with realistic human variance
    function typewrite(element: Element, preStoredText?: string): Promise<void> {
      return new Promise((resolve) => {
        const text = preStoredText || element.textContent || '';
        const prompt = element.closest('[data-beat]')?.querySelector('.claude-terminal__prompt');

        element.textContent = '';
        const cursor = document.createElement('span');
        cursor.className = 'claude-terminal__cursor';
        element.appendChild(cursor);

        let charIndex = 0;

        function typeNextChar() {
          if (charIndex < text.length) {
            const char = document.createTextNode(text[charIndex]);
            element.insertBefore(char, cursor);
            charIndex++;

            // Only scroll every 8 characters to reduce jitter
            if (charIndex % 8 === 0 || charIndex === text.length) {
              scrollToElement(element);
            }

            // Realistic timing variance
            const baseDelay = TIMING.typewriterSpeed;
            const variance = (Math.random() * TIMING.typewriterVariance * 2) - TIMING.typewriterVariance;
            const punctuation = [',', '.', '?', '!', ';', ':'];
            const extraPause = punctuation.includes(text[charIndex - 1]) ? TIMING.typewriterPunctuationPause : 0;

            // Occasional brief hesitation (human thinking)
            const hesitation = Math.random() < 0.03 ? 150 : 0;

            setTimeout(typeNextChar, baseDelay + variance + extraPause + hesitation);
          } else {
            setTimeout(() => {
              cursor.classList.add('claude-terminal__cursor--hidden');
              if (prompt) prompt.classList.add('is-complete');
              setTimeout(() => {
                cursor.remove();
                resolve();
              }, 100);
            }, TIMING.cursorLingerTime);
          }
        }

        typeNextChar();
      });
    }

    // Reveal Claude response elements with proper pacing
    function revealClaudeResponse(beat: Element): Promise<void> {
      return new Promise((resolve) => {
        const revealElements = beat.querySelectorAll('[data-reveal]');
        let delay = 0;

        revealElements.forEach((el) => {
          const type = el.getAttribute('data-reveal');
          const isToolCall = type === 'tool';

          if (isToolCall) {
            delay += TIMING.toolRevealDelay;
          }

          setTimeout(() => {
            el.classList.add('is-revealed');
            scrollToElement(el, true); // immediate scroll for reveals
            updateOverflowState();
          }, delay);

          delay += TIMING.revealStagger;

          // Simulate "processing" time after tool calls
          if (isToolCall) {
            delay += TIMING.postToolPause;
          }
        });

        setTimeout(resolve, delay + 150);
      });
    }

    // Main animation sequence
    async function runAnimation() {
      // Wait for page entry animation to complete before starting
      await new Promise(r => setTimeout(r, TIMING.pageEntryWait));

      terminal.setAttribute('data-animation-started', 'true');

      // Reset scroll to top when animation begins
      if (contentArea) {
        contentArea.scrollTop = 0;
      }

      for (let i = 0; i < beats.length; i++) {
        const beat = beats[i];
        const beatNum = beat.getAttribute('data-beat');
        const isUserBeat = beat.classList.contains('claude-terminal__message--user');
        const typewriterEl = beat.querySelector('[data-typewriter]') as HTMLElement | null;
        const isLastBeat = i === beats.length - 1;

        // Check if previous beat was also a Claude message (consecutive Claude messages)
        const prevBeat = i > 0 ? beats[i - 1] : null;
        const prevWasClaude = prevBeat && prevBeat.classList.contains('claude-terminal__message--claude');
        const isClaudeBeat = beat.classList.contains('claude-terminal__message--claude');

        if (isUserBeat && typewriterEl) {
          // Store text and clear BEFORE revealing to prevent flash
          const storedText = typewriterEl.textContent || '';
          typewriterEl.textContent = '';

          // Add blinking cursor immediately for anticipation
          const earlyCursor = document.createElement('span');
          earlyCursor.className = 'claude-terminal__cursor';
          typewriterEl.appendChild(earlyCursor);

          // User message: reveal container with cursor visible
          beat.classList.add('is-revealed');
          scrollToElement(beat, true);

          // Brief pause with cursor blinking creates anticipation
          await new Promise(r => setTimeout(r, TIMING.typewriterStartDelay));

          // Remove early cursor before typewrite adds its own
          earlyCursor.remove();
          await typewrite(typewriterEl, storedText);

          // After user types, show thinking indicator for next Claude response
          const nextThinkingId = beatNum;
          const thinkingEl = terminal.querySelector(`[data-thinking="${nextThinkingId}"]`);
          if (thinkingEl) {
            const words = thinkingEl.querySelector('.claude-terminal__thinking-text')?.textContent === 'Writing'
              ? WRITING_WORDS
              : THINKING_WORDS;
            const thinking = showThinking(nextThinkingId, words);
            await new Promise(r => setTimeout(r, TIMING.thinkingMinDuration));
            await thinking.stop(); // await the fade-out
          }
        } else {
          // Check for thinking indicator before consecutive Claude messages
          if (isClaudeBeat && prevWasClaude && beatNum) {
            const prevBeatNum = parseInt(beatNum, 10) - 1;
            const thinkingEl = terminal.querySelector(`[data-thinking="${prevBeatNum}"]`);
            if (thinkingEl) {
              const thinking = showThinking(String(prevBeatNum), THINKING_WORDS);
              await new Promise(r => setTimeout(r, TIMING.thinkingMinDuration));
              await thinking.stop();
            }
          }

          // Claude message: staggered reveal
          await new Promise(r => setTimeout(r, TIMING.claudeResponseDelay));
          beat.classList.add('is-revealed');
          scrollToElement(beat, true);
          await revealClaudeResponse(beat);
        }

        // Gap before next beat
        const gap = isLastBeat ? TIMING.finalBeatGap : TIMING.beatGap;
        await new Promise(r => setTimeout(r, gap));
      }

      updateOverflowState();
    }

    // Set up scroll listener for fade effect
    if (contentArea) {
      contentArea.addEventListener('scroll', updateOverflowState);
    }

    // Trigger animation when terminal enters viewport
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            runAnimation(); // pageEntryWait handles the delay
            observer.disconnect();
          }
        });
      },
      { threshold: 0.2 } // Trigger slightly earlier
    );

    observer.observe(terminal);
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTerminalAnimation);
  } else {
    initTerminalAnimation();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initTerminalAnimation);

  /**
   * Scroll-Triggered Reveal Animations
   * Uses IntersectionObserver for performance
   */
  function initScrollReveal() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) {
      // Show everything immediately
      document.querySelectorAll('.story, .faq, .invitation').forEach(el => {
        el.classList.add('is-visible');
      });
      return;
    }

    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -10% 0px', // Trigger slightly before fully in view
      threshold: 0.1
    };

    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          revealObserver.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Observe all reveal targets
    document.querySelectorAll('.story, .faq, .invitation').forEach(el => {
      revealObserver.observe(el);
    });
  }

  /**
   * Subtle Parallax for Atmosphere Orb
   * Moves opposite to scroll for depth
   */
  function initAtmosphereParallax() {
    const orb = document.querySelector('.atmosphere__orb') as HTMLElement | null;
    if (!orb) return;

    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) return;

    let ticking = false;

    function updateParallax() {
      const scrollY = window.scrollY;
      // Subtle parallax: move up as user scrolls down (0.05x speed)
      const parallaxY = scrollY * 0.05;
      orb.style.transform = `translateX(-50%) translateY(${-parallaxY}px)`;
      ticking = false;
    }

    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(updateParallax);
        ticking = true;
      }
    }, { passive: true });
  }

  // Initialize scroll effects
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initScrollReveal();
      initAtmosphereParallax();
    });
  } else {
    initScrollReveal();
    initAtmosphereParallax();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', () => {
    initScrollReveal();
    initAtmosphereParallax();
  });
</script>
