---
/**
 * Homepage — The marketing AI directory.
 *
 * Density: LOW (hero) → HIGH (proof bar) → MEDIUM (value grid) →
 *          HIGH (directory preview) → RUPTURE → MEDIUM (product) →
 *          LOW (CTA void)
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import EmailSignup from '../components/EmailSignup.astro';
import ToolCard from '../components/ToolCard.astro';
import ProductCallout from '../components/ProductCallout.astro';

const allTools = await getCollection('tools');
const toolCount = allTools.length;
const categories = new Set(allTools.map(t => t.data.type));

// First 8 tools for directory preview
const previewTools = allTools.slice(0, 8);

// Route prefixes
const typePrefix: Record<string, string> = {
  skill: 'skills',
  mcp: 'mcps',
  plugin: 'plugins',
  subagent: 'coming-soon',
};

function toolHref(tool: { id: string; data: { type: string } }) {
  if (tool.data.type === 'subagent') return '/coming-soon';
  const slug = tool.id.split('/').pop()?.replace(/\.md$/, '');
  return `/${typePrefix[tool.data.type]}/${slug}`;
}

const schema = [
  {
    '@type': 'Organization',
    'name': 'Channel 47',
    'url': 'https://channel47.dev',
    'logo': 'https://channel47.dev/og-image.png',
    'description': 'The marketing AI directory. Skills, MCPs, and plugins for marketing workflows.',
    'founder': {
      '@type': 'Person',
      'name': 'Jackson Dean',
      'url': 'https://x.com/ctrlswing',
    },
    'sameAs': [
      'https://github.com/channel47',
      'https://x.com/ctrlswing',
    ],
  },
  {
    '@type': 'WebSite',
    'name': 'Channel 47',
    'url': 'https://channel47.dev',
  },
];
---

<BaseLayout
  title="Channel 47 — The Marketing AI Directory"
  description="Skills, MCPs, and plugins for marketing workflows. Browse by profession. Install and run. Build your own."
  schema={schema}
>
  <Nav />

  <main id="main-content">

    <!-- ═══════ HERO — LOW density ═══════ -->
    <section class="hero is-visible">
      <div class="hero__inner">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label hero__label">Transmitting</p>
        <h1 class="hero__headline">The marketing<br />AI directory.</h1>
        <p class="hero__sub">
          Skills, MCPs, and plugins for marketing workflows.<br />
          Browse by profession. Install and run. Build your own.
        </p>
        <div class="hero__cta">
          <EmailSignup variant="inline" placeholder="you@domain.com" tag="home" submitText="Subscribe" />
        </div>
      </div>
    </section>

    <!-- ═══════ PROOF BAR — HIGH density ═══════ -->
    <section class="proof-bar" data-reveal-stagger>
      <div class="proof-bar__item" data-reveal-child data-stagger="1">
        <span class="proof-bar__value" data-counter={String(toolCount)}>{toolCount}</span>
        <span class="proof-bar__label">Tools</span>
      </div>
      <div class="proof-bar__item" data-reveal-child data-stagger="2">
        <span class="proof-bar__value proof-bar__value--signal" data-counter={String(categories.size)}>{categories.size}</span>
        <span class="proof-bar__label">Categories</span>
      </div>
      <div class="proof-bar__item" data-reveal-child data-stagger="3">
        <span class="proof-bar__value">Weekly</span>
        <span class="proof-bar__label">Updates</span>
      </div>
      <div class="proof-bar__item" data-reveal-child data-stagger="4">
        <span class="proof-bar__value">500+</span>
        <span class="proof-bar__label">Workshop Builders</span>
      </div>
    </section>

    <!-- ═══════ VALUE GRID — MEDIUM density ═══════ -->
    <section class="value-grid">
      <div class="wrap">
        <div class="value-grid__grid" data-reveal-stagger>
          <div class="value-grid__cell value-grid__cell--soot" data-reveal-child data-stagger="1">
            <span class="value-grid__idx">001</span>
            <h3 class="value-grid__title">Organized by profession</h3>
            <p class="value-grid__desc">
              Not a flat list. Browse skills, MCPs, and plugins categorized by what you actually do. Install a profession plugin and get everything your role needs.
            </p>
          </div>
          <div class="value-grid__cell value-grid__cell--smoke" data-reveal-child data-stagger="2">
            <span class="value-grid__idx">002</span>
            <h3 class="value-grid__title">Skills + tools</h3>
            <p class="value-grid__desc">
              Knowledge tells AI how to think. Tools give AI hands. Registry items bundle both — scripts that call APIs, process data, and return structured results.
            </p>
          </div>
          <div class="value-grid__cell value-grid__cell--smoke" data-reveal-child data-stagger="3">
            <span class="value-grid__idx">003</span>
            <h3 class="value-grid__title">Built from real workflows</h3>
            <p class="value-grid__desc">
              Every item comes from production use. The media-buyer plugin was built managing 25+ ad accounts daily. Not hypothetical. Not demos.
            </p>
          </div>
          <div class="value-grid__cell value-grid__cell--soot" data-reveal-child data-stagger="4">
            <span class="value-grid__idx">047</span>
            <h3 class="value-grid__title">Open source</h3>
            <p class="value-grid__desc">
              Install, fork, contribute. The registry grows as practitioners add their domain expertise. Contributing is career leverage.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- ═══════ DIRECTORY PREVIEW — HIGH density ═══════ -->
    <section class="directory" data-reveal-stagger>
      <div class="wrap">
        <div class="directory__header" data-reveal-child data-stagger="1">
          <h2 class="directory__title">Browse the directory</h2>
          <a href="/skills" class="directory__link">View all &rarr;</a>
        </div>
        <ul class="directory__list">
          {previewTools.map((tool, i) => (
            <ToolCard
              name={tool.data.name}
              description={tool.data.description}
              type={tool.data.type}
              href={toolHref(tool)}
              index={i + 1}
              variant="compact"
            />
          ))}
        </ul>
      </div>
    </section>

    <!-- ═══════ RUPTURE — surface flip ═══════ -->
    <section class="rupture" data-reveal>
      <div class="rupture__inner">
        <div class="rupture__bar"></div>
        <p class="label label--muted" style="margin-bottom: 20px;">Signal</p>
        <h2 class="rupture__headline">The people who build skills become the most valuable people in their field.</h2>
        <p class="rupture__body">
          Every tool here was built from a real workflow. Install and run, or learn how it's made and build your own.
        </p>
        <a href="/notes" class="rupture__link">Read the build notes &rarr;</a>
      </div>
    </section>

    <!-- ═══════ PRODUCT CALLOUT — MEDIUM density ═══════ -->
    <ProductCallout />

    <!-- ═══════ CTA VOID — LOW density ═══════ -->
    <section class="cta" data-reveal>
      <p class="label cta__label">ch47</p>
      <a href="/subscribe" class="cta__headline">Start building.</a>
      <a href="/subscribe" class="btn-signal">Subscribe to Build Notes</a>
    </section>

    <Footer />
  </main>
</BaseLayout>

<style>
  /* Compact directory rows need stagger attrs set via data-reveal-child */
  .directory__list :global(li) {
    opacity: 0;
    transform: translateY(16px);
    transition: opacity var(--dur-measured) var(--ease-out),
                transform var(--dur-measured) var(--ease-out);
  }
  .directory__list :global(li.is-visible),
  .directory.is-visible .directory__list :global(li) {
    opacity: 1;
    transform: translateY(0);
  }
  /* Stagger the directory rows */
  .directory__list :global(li:nth-child(1)) { transition-delay: 80ms; }
  .directory__list :global(li:nth-child(2)) { transition-delay: 160ms; }
  .directory__list :global(li:nth-child(3)) { transition-delay: 240ms; }
  .directory__list :global(li:nth-child(4)) { transition-delay: 320ms; }
  .directory__list :global(li:nth-child(5)) { transition-delay: 400ms; }
  .directory__list :global(li:nth-child(6)) { transition-delay: 480ms; }
  .directory__list :global(li:nth-child(7)) { transition-delay: 560ms; }
  .directory__list :global(li:nth-child(8)) { transition-delay: 640ms; }

  @media (prefers-reduced-motion: reduce) {
    .directory__list :global(li) {
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>
