---
/**
 * Notes Hub — Build Notes index page.
 *
 * Density: LOW (hero) → MEDIUM (content grid) → MEDIUM (signup) → LOW (cta void)
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import ContentCard from '../../components/ContentCard.astro';
import EmailSignup from '../../components/EmailSignup.astro';

const notes = (await getCollection('notes', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const tags = ['all', 'breakdown', 'story', 'guide'] as const;
---

<BaseLayout
  title="Build Notes — Channel 47"
  description="Weekly breakdowns from the Channel 47 ecosystem. Stories, guides, and skill teardowns from building AI plugins for real work."
>
  <Nav />
  <main id="main-content" class="pg">

    <!-- HERO (LOW density) -->
    <section class="hero" data-section="hero">
      <div class="hero__content">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label">FROM THE WORKSHOP</p>
        <h1 class="hero__headline">Build Notes</h1>
        <p class="hero__sub">
          Stories, guides, and breakdowns from building AI plugins for real work.
          Every week, one skill from the ecosystem. Taken apart.
        </p>
      </div>
    </section>

    <!-- CONTENT GRID (MEDIUM density) -->
    <section class="notes-grid py-[clamp(40px,6vh,60px)] px-[clamp(24px,5vw,64px)]" data-section="notes-grid">
      <div class="mb-6">
        <div class="flex gap-2 flex-wrap" data-tag-filter>
          {tags.map((t) => (
            <button
              class:list={['notes-grid__tag', t === 'all' && 'is-active']}
              data-filter={t}
            >
              {t.toUpperCase()}
            </button>
          ))}
        </div>
      </div>
      <div class="max-w-[672px]">
        {notes.map((note, i) => (
          <div data-animate="fade-up" data-stagger={String(Math.min(i + 1, 6))} data-tag-value={note.data.tag}>
            <ContentCard
              title={note.data.title}
              description={note.data.description}
              date={note.data.date}
              tag={note.data.tag}
              slug={note.id.replace(/\.md$/, '')}
            />
          </div>
        ))}
      </div>
      {notes.length === 0 && (
        <p class="font-mono text-sm text-gray-500 py-10">First notes are coming soon.</p>
      )}
    </section>

    <!-- SIGNUP (MEDIUM density) -->
    <section class="py-[clamp(60px,10vh,100px)] px-[clamp(24px,5vw,64px)] border-t border-gray-200" data-section="notes-signup">
      <div>
        <p class="label mb-2">BUILD NOTES</p>
        <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold tracking-tight leading-[1.1] text-primary mb-3" style="font-family: var(--font-family-heading);">Get these in your inbox.</h2>
        <p class="font-mono text-[11px] tracking-wide text-gray-500 uppercase mb-4">No spam. Unsubscribe anytime.</p>
        <EmailSignup placeholder="you@domain.com" tag="notes" submitText="Subscribe" />
      </div>
    </section>

    <!-- CTA VOID (LOW density) -->
    <section class="cta" data-section="cta">
      <p class="label">TRANSMITTING</p>
      <a class="cta__action" href="/">Browse the registry</a>
    </section>

    <Footer />
  </main>

  <script>
    import { initPageMotion } from '../../scripts/page-motion';
    initPageMotion();
  </script>

  <!-- Tag filter (minimal JS toggle) -->
  <script>
    function initTagFilter() {
      const container = document.querySelector('[data-tag-filter]');
      if (!container || container.hasAttribute('data-initialized')) return;
      container.setAttribute('data-initialized', 'true');

      const buttons = container.querySelectorAll('[data-filter]');
      const items = document.querySelectorAll('[data-tag-value]');

      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const filter = (btn as HTMLElement).dataset.filter;

          buttons.forEach((b) => b.classList.remove('is-active'));
          btn.classList.add('is-active');

          items.forEach((item) => {
            const el = item as HTMLElement;
            if (filter === 'all' || el.dataset.tagValue === filter) {
              el.style.display = '';
            } else {
              el.style.display = 'none';
            }
          });
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTagFilter);
    } else {
      initTagFilter();
    }

    document.addEventListener('astro:page-load', initTagFilter);
  </script>
</BaseLayout>

<style>
  /* Tag filter buttons — interactive states */
  .notes-grid__tag {
    font-family: var(--font-family-mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: 6px 12px;
    border-radius: 2px;
    background: transparent;
    color: #8a857e;
    border: 1px solid #292929;
    cursor: pointer;
    transition: color 100ms var(--ease-signature),
                border-color 100ms var(--ease-signature),
                background-color 100ms var(--ease-signature);
  }
  .notes-grid__tag:focus-visible {
    outline: 2px solid #f59e0b;
    outline-offset: 2px;
  }
  .notes-grid__tag:hover {
    color: #e7e5e4;
    border-color: #504b46;
  }
  .notes-grid__tag.is-active {
    color: #f59e0b;
    border-color: #f59e0b;
    background: rgba(245, 158, 11, 0.12);
  }

  /* CTA action link */
  .cta__action {
    font-family: var(--font-family-heading);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 500;
    color: #f5f5f4;
    position: relative;
    display: inline-block;
    margin-bottom: 40px;
    transition: color 150ms var(--ease-signature);
  }
  .cta__action::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -6px;
    width: 100%;
    height: 2px;
    background: #f59e0b;
    transform-origin: left;
    transition: transform 250ms var(--ease-signature);
  }
  .cta__action:hover { color: #f59e0b; }
  .cta__action:hover::after { transform: scaleX(0); transform-origin: right; }
  .cta__action:focus-visible { outline: 2px solid #f59e0b; outline-offset: 4px; }

  @media (prefers-reduced-motion: reduce) {
    .notes-grid__tag { transition: none; }
    .cta__action, .cta__action::after { transition: none; }
  }
</style>
