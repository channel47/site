---
/**
 * Notes Hub — Build Notes index page.
 * Density: LOW (hero) → MEDIUM (content grid) → LOW (rupture signup) → LOW (cta void)
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import ContentCard from '../../components/ContentCard.astro';
import EmailSignup from '../../components/EmailSignup.astro';

const notes = (await getCollection('notes', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const tags = ['all', 'breakdown', 'story', 'guide'] as const;

const schema = {
  '@type': 'BreadcrumbList',
  'itemListElement': [
    { '@type': 'ListItem', 'position': 1, 'name': 'Home', 'item': 'https://channel47.dev/' },
    { '@type': 'ListItem', 'position': 2, 'name': 'Build Notes' },
  ],
};
---

<BaseLayout
  title="Build Notes — Channel 47"
  description="Skill breakdowns, build process, and the dead ends that led somewhere."
  schema={schema}
>
  <Nav />
  <main id="main-content">

    <!-- HERO -->
    <section class="hero hero--compact" data-section="hero">
      <div class="hero__inner">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label hero__label">BUILD NOTES</p>
        <h1 class="hero__headline max-w-[16ch]">How the tools get built.</h1>
        <p class="hero__sub">
          Skill breakdowns, build decisions, and the dead ends that led somewhere. From managing 25+ ad accounts daily.
        </p>
      </div>
    </section>

    <!-- ═══════ DEFINITION — AI-extractable answer block ═══════ -->
    <section class="py-[clamp(40px,6vh,60px)] border-t border-smoke" data-reveal>
      <div class="wrap">
        <p class="font-mono text-sm text-dust leading-[1.75] tracking-wide max-w-[600px]">
          Build Notes is Channel 47's weekly publication covering how AI skills and plugins get built for media buyers. Each issue breaks down a real tool — the workflow it automates, the decisions behind the architecture, and what went wrong along the way. Written by Jackson Dean, who manages 25+ Google Ads and Bing Ads accounts daily.
        </p>
      </div>
    </section>

    <!-- CONTENT GRID -->
    <section class="notes-grid py-[clamp(60px,10vh,100px)]" data-section="notes-grid">
      <div class="wrap">
      <div class="mb-6">
        <div class="flex gap-2 flex-wrap" data-tag-filter>
          {tags.map((t) => (
            <button
              class:list={['notes-grid__tag', t === 'all' && 'is-active']}
              data-filter={t}
            >
              {t.toUpperCase()}
            </button>
          ))}
        </div>
      </div>
      <div class="max-w-[672px]">
        {notes.map((note, i) => (
          <div data-animate="fade-up" data-stagger={String(Math.min(i + 1, 6))} data-tag-value={note.data.tag}>
            <ContentCard
              title={note.data.title}
              description={note.data.description}
              date={note.data.date}
              tag={note.data.tag}
              slug={note.id.replace(/\.md$/, '')}
            />
          </div>
        ))}
      </div>
      {notes.length === 0 && (
        <p class="font-mono text-sm text-stone py-10">First notes are coming soon.</p>
      )}
      </div>
    </section>

    <!-- SIGNUP RUPTURE -->
    <section class="rupture" data-section="notes-signup">
      <div class="max-w-[640px] mx-auto relative pl-8">
        <div class="accent-bar-v" aria-hidden="true"></div>
        <p class="label text-ink/50 mb-2">BUILD NOTES</p>
        <h2 class="font-display text-ink text-[clamp(1.5rem,3vw,2rem)] font-semibold tracking-tight leading-[1.1] mb-3">Get breakdowns like this weekly.</h2>
        <EmailSignup placeholder="you@domain.com" tag="notes" submitText="Get Build Notes" />
      </div>
    </section>

    <!-- CTA VOID -->
    <section class="cta" data-section="cta">
      <a class="cta__headline" href="/plugins">See the plugins</a>
      <a href="/subscribe" class="btn-signal">Subscribe to Build Notes</a>
    </section>

    <Footer />
  </main>

  <!-- Tag filter -->
  <script>
    function initTagFilter() {
      const container = document.querySelector('[data-tag-filter]');
      if (!container || container.hasAttribute('data-initialized')) return;
      container.setAttribute('data-initialized', 'true');

      const buttons = container.querySelectorAll('[data-filter]');
      const items = document.querySelectorAll('[data-tag-value]');

      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const filter = (btn as HTMLElement).dataset.filter;

          buttons.forEach((b) => b.classList.remove('is-active'));
          btn.classList.add('is-active');

          items.forEach((item) => {
            const el = item as HTMLElement;
            if (filter === 'all' || el.dataset.tagValue === filter) {
              el.style.display = '';
            } else {
              el.style.display = 'none';
            }
          });
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTagFilter);
    } else {
      initTagFilter();
    }
    document.addEventListener('astro:page-load', initTagFilter);
  </script>
</BaseLayout>

<style>
  .notes-grid__tag {
    font-family: var(--font-family-mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: 6px 12px;
    border-radius: var(--radius-tight);
    background: transparent;
    color: var(--color-stone);
    border: 1px solid var(--color-smoke);
    cursor: pointer;
    transition: color 100ms var(--ease-out),
                border-color 100ms var(--ease-out),
                background-color 100ms var(--ease-out);
  }
  .notes-grid__tag:focus-visible { outline: 2px solid var(--color-signal); outline-offset: 2px; }
  .notes-grid__tag:hover { color: var(--color-bone); border-color: var(--color-ash); }
  .notes-grid__tag.is-active {
    color: var(--color-signal);
    border-color: var(--color-signal);
    background: var(--signal-dim-alpha);
  }

  @media (prefers-reduced-motion: reduce) {
    .notes-grid__tag { transition: none; }
  }
</style>
