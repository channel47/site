---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import ToolCard from '../../components/ToolCard.astro';

const allTools = await getCollection('tools');
const mcps = allTools.filter(t => t.data.type === 'mcp');
---

<BaseLayout
  title="MCP Servers for Marketing Workflows â€” Channel 47"
  description="MCP servers for marketing workflows. Connect Claude Code, Cursor, and other agents to marketing APIs."
>
  <Nav />

  <main id="main-content" class="pt-24 pb-12 px-[clamp(24px,5vw,64px)]">
    <div class="max-w-[1060px] mx-auto">
      <Breadcrumbs items={[
        { label: 'Home', href: '/' },
        { label: 'MCPs' },
      ]} />

      <h1 class="font-heading text-[clamp(1.5rem,3vw,2rem)] font-semibold tracking-tight leading-[1.1] mb-6" style="font-family: var(--font-family-heading);">
        MCP servers for marketing workflows.
      </h1>

      <div class="mb-5">
        <label for="mcp-search" class="sr-only">Search MCPs</label>
        <input
          type="text"
          id="mcp-search"
          placeholder="Search MCPs..."
          class="w-full px-4 h-12 font-mono text-sm text-gray-700 bg-gray-100/80 border border-gray-300 rounded-tight outline-none transition-[border-color,box-shadow] duration-100 placeholder:text-gray-500 hover:border-gray-400 focus-visible:border-amber focus-visible:shadow-[0_0_0_4px_rgba(245,158,11,0.2)]"
          autocomplete="off"
          spellcheck="false"
        />
      </div>

      <p class="font-mono text-[11px] text-gray-500 mb-6">{mcps.length} MCPs</p>

      <div id="hub-list">
        {mcps.map(tool => (
          <ToolCard
            name={tool.data.name}
            description={tool.data.description}
            type={tool.data.type}
            href={`/mcps/${tool.id.split('/').pop()}`}
          />
        ))}
      </div>

      <p id="no-results" class="font-mono text-sm text-gray-500 py-8 hidden">No MCPs match your search.</p>
    </div>
  </main>

  <Footer />

  <script>
    function initHubSearch() {
      const input = document.querySelector('[id$="-search"]') as HTMLInputElement;
      const list = document.getElementById('hub-list');
      const noResults = document.getElementById('no-results');
      if (!input || !list) return;

      const cards = list.querySelectorAll('[data-name]');

      input.addEventListener('input', () => {
        const query = input.value.toLowerCase().trim();
        let visibleCount = 0;

        cards.forEach(card => {
          const name = card.getAttribute('data-name') || '';
          const desc = card.getAttribute('data-description') || '';
          const matches = !query || name.includes(query) || desc.includes(query);
          (card as HTMLElement).style.display = matches ? '' : 'none';
          if (matches) visibleCount++;
        });

        if (noResults) {
          noResults.classList.toggle('hidden', visibleCount > 0);
        }
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initHubSearch);
    } else {
      initHubSearch();
    }
    document.addEventListener('astro:page-load', initHubSearch);
  </script>
</BaseLayout>
