---
/**
 * /hire — Consulting Intake
 * Custom AI skill build requests. Sends to Kit with "hire" tag + fields.
 *
 * Density map (earned-ask structure):
 * HIGH (hook + proof) → MEDIUM (packages) → LOW (process) → HIGH (CTA + form) → LOW (fallback)
 *
 * The form sits behind three credibility zones. By the time someone
 * reaches the ask, they've seen what you build, how you build it,
 * and proof that it ships.
 */
import FormPageLayout from '../layouts/FormPageLayout.astro';

const schema = {
  '@type': 'Service',
  'name': 'Custom AI Skill Building',
  'url': 'https://channel47.dev/hire',
  'description': 'Custom AI skills for your workflow. Workflow automations, content systems, campaign tools, reporting pipelines.',
  'provider': {
    '@type': 'Person',
    'name': 'Jackson Dean',
    'url': 'https://x.com/ctrlswing',
  },
  'serviceType': 'AI Workflow Consulting',
};
---

<FormPageLayout
  title="Work With Me — Channel47"
  description="Custom AI skills for your workflow. Workflow automations, content systems, campaign tools, reporting pipelines. Limited availability."
  class="hire"
  schema={schema}
>

  <!-- All page content (hidden on form success) -->
  <div class="hire__content" data-hire-form-section>

    <!-- =========================================
         ZONE 1: Hook (HIGH density)
         Outcome-focused. Say what you do,
         prove you've done it, move on.
         ========================================= -->
    <section class="fp-section">
      <div class="fp-bar" aria-hidden="true"></div>
      <p class="fp-label fp-label--accent">CUSTOM BUILDS</p>
      <h1 class="fp-heading">I build the tool.<br/>You describe the workflow.</h1>

      <div class="hire__proof">
        <span class="hire__proof-item">25+ ad accounts managed daily</span>
        <span class="hire__proof-pipe" aria-hidden="true"></span>
        <span class="hire__proof-item">$3K/mo waste caught by one skill</span>
        <span class="hire__proof-pipe" aria-hidden="true"></span>
        <span class="hire__proof-item">~250 live workshop attendees</span>
      </div>

      <p class="fp-body">
        For founders and operators who keep losing hours to manual workflows.
        You describe it once — I ship a tool that runs it. Yours to own.
      </p>

      <p class="hire__scarcity">A handful of projects at a time.</p>

      <a href="#packages" class="fp-btn fp-btn--secondary hire__hero-cta">
        See packages <span class="fp-arrow" aria-hidden="true">↓</span>
      </a>
    </section>

    <!-- =========================================
         ZONE 2: Packages (MEDIUM density)
         Three tiers with transparent pricing.
         Middle tier featured with accent border.
         ========================================= -->
    <section class="fp-section hire__packages" id="packages">
      <p class="fp-label">PACKAGES</p>

      <div class="hire__tiers">
        <div class="fp-card hire__tier">
          <span class="hire__tier-label">Tier 1</span>
          <span class="hire__tier-name">Skill Build</span>
          <span class="hire__tier-price">$500</span>
          <span class="hire__tier-scope">One Claude Code skill, scoped from a 10-minute call.</span>
          <span class="hire__tier-example">URL in → ad campaign out</span>
          <span class="hire__tier-delivery">Delivery: 3–5 days</span>
        </div>

        <div class="fp-card hire__tier hire__tier--featured">
          <span class="hire__tier-label">Tier 2</span>
          <span class="hire__tier-name">Workflow Kit</span>
          <span class="hire__tier-price">$2,500</span>
          <span class="hire__tier-scope">Multi-step workflow connecting 2–3 skills. Tested against real data.</span>
          <span class="hire__tier-example">Brand brief in → campaign assets out</span>
          <span class="hire__tier-delivery">Delivery: 1–2 weeks</span>
        </div>

        <div class="fp-card hire__tier">
          <span class="hire__tier-label">Tier 3</span>
          <span class="hire__tier-name">Custom System</span>
          <span class="hire__tier-price">From $5,000</span>
          <span class="hire__tier-scope">End-to-end pipeline with documentation, monitoring, and handoff.</span>
          <span class="hire__tier-example">Daily notes in → distributed content out</span>
          <span class="hire__tier-delivery">Delivery: 2–4 weeks</span>
        </div>
      </div>
    </section>

    <!-- =========================================
         ZONE 3: Process (LOW density)
         Three steps. Sparse. Confident.
         The Index signature move (mono counters).
         ========================================= -->
    <section class="fp-section hire__process">
      <p class="fp-label">HOW IT WORKS</p>
      <h2 class="fp-heading fp-heading--sm">Three steps. That's it.</h2>

      <div class="hire__steps">
        <div class="hire__step">
          <span class="hire__step-num" aria-hidden="true">01</span>
          <div class="hire__step-body">
            <p class="hire__step-title">Talk through the workflow</p>
            <p class="hire__step-desc">A 10-minute conversation scopes the build.</p>
          </div>
        </div>

        <div class="hire__step">
          <span class="hire__step-num" aria-hidden="true">02</span>
          <div class="hire__step-body">
            <p class="hire__step-title">I build and test it</p>
            <p class="hire__step-desc">Custom skill, tested against real data, documented.</p>
          </div>
        </div>

        <div class="hire__step">
          <span class="hire__step-num" aria-hidden="true">03</span>
          <div class="hire__step-body">
            <p class="hire__step-title">You run it yourself</p>
            <p class="hire__step-desc">Your tool, your workflow. Full ownership after delivery.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- =========================================
         ZONE 4: CTA + Form (HIGH density — RUPTURE)
         "LIVE" label signals real-time availability.
         Primary CTA is the one Signal-fill button.
         Form is the async fallback path.
         ========================================= -->
    <section class="fp-section hire__form-zone" id="start">
      <div class="fp-bar" aria-hidden="true"></div>
      <p class="fp-label fp-label--accent">LIVE</p>
      <h2 class="fp-heading fp-heading--sm">Start the conversation now.</h2>

      <button type="button" class="fp-btn fp-btn--primary hire__cta-primary" data-hire-cta>
        Start a conversation <span class="fp-arrow" aria-hidden="true">→</span>
      </button>

      <form class="hire__form" data-hire-form>
        <label class="visually-hidden" for="hire-email">Email</label>
        <input
          type="email"
          id="hire-email"
          class="fp-input"
          placeholder="your@email.com"
          required
          autocomplete="email"
        />
        <label class="visually-hidden" for="hire-task">What you're trying to solve</label>
        <textarea
          id="hire-task"
          class="fp-input hire__textarea"
          placeholder="What's the workflow you want to improve?"
          rows="4"
          maxlength="1000"
          required
        ></textarea>
        <div class="hire__budget-group">
          <p class="hire__budget-label">Budget range</p>
          <div class="hire__budget-grid" data-budget-group>
            <button type="button" class="hire__budget-btn" data-budget="under-500" aria-pressed="false">Under $500</button>
            <button type="button" class="hire__budget-btn" data-budget="500-2k" aria-pressed="false">$500 – $2K</button>
            <button type="button" class="hire__budget-btn" data-budget="2k-5k" aria-pressed="false">$2K – $5K</button>
            <button type="button" class="hire__budget-btn" data-budget="5k-plus" aria-pressed="false">$5K+</button>
          </div>
        </div>
        <input type="hidden" id="hire-budget" value="" />
        <p class="hire__error" data-hire-error hidden></p>
        <button type="submit" class="fp-btn fp-btn--secondary fp-btn--lg" data-hire-submit>
          Send inquiry <span class="fp-arrow" aria-hidden="true">→</span>
        </button>
      </form>
    </section>

    <!-- Zone 5: Fallback (LOW density exit ramp) -->
    <p class="hire__fallback">
      Not ready? <a href="/subscribe" class="hire__fallback-link">Get the build notes</a> instead.
    </p>

  </div>

  <!-- Success view (hidden by default) -->
  <section class="fp-section hire__success" hidden data-hire-success>
    <div class="fp-bar" aria-hidden="true"></div>
    <p class="fp-label fp-label--accent">RECEIVED</p>
    <h1 class="fp-heading">Got it. I'll take a look.</h1>
    <p class="fp-body">I review every inquiry personally. If it's a good fit, I'll reach out within 48 hours to schedule a call.</p>
    <a href="/" class="hire__back-link">← Back to channel47</a>
  </section>

</FormPageLayout>

<script>
  function initHireForm() {
    const form = document.querySelector('[data-hire-form]') as HTMLFormElement;
    if (!form || form.hasAttribute('data-initialized')) return;
    form.setAttribute('data-initialized', 'true');

    const EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const submitBtn = form.querySelector('[data-hire-submit]') as HTMLButtonElement;
    const errorEl = document.querySelector('[data-hire-error]') as HTMLElement;
    const formSection = document.querySelector('[data-hire-form-section]') as HTMLElement;
    const successSection = document.querySelector('[data-hire-success]') as HTMLElement;
    const budgetHidden = form.querySelector('#hire-budget') as HTMLInputElement;
    const budgetBtns = form.querySelectorAll('[data-budget]') as NodeListOf<HTMLButtonElement>;
    const ctaBtn = document.querySelector('[data-hire-cta]') as HTMLButtonElement;

    // Primary CTA — focus email input (placeholder for voice agent)
    if (ctaBtn) {
      ctaBtn.addEventListener('click', () => {
        const emailInput = form.querySelector('#hire-email') as HTMLInputElement;
        if (emailInput) emailInput.focus();
      });
    }

    // Budget button group — select one at a time
    budgetBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        budgetBtns.forEach((b) => b.setAttribute('aria-pressed', 'false'));
        btn.setAttribute('aria-pressed', 'true');
        budgetHidden.value = btn.getAttribute('data-budget') || '';
        clearError();
      });
    });

    function showError(msg: string) {
      if (errorEl) {
        errorEl.textContent = msg;
        errorEl.hidden = false;
      }
    }

    function clearError() {
      if (errorEl) {
        errorEl.textContent = '';
        errorEl.hidden = true;
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearError();

      const emailInput = form.querySelector('#hire-email') as HTMLInputElement;
      const taskInput = form.querySelector('#hire-task') as HTMLTextAreaElement;

      const email = emailInput.value.trim();
      const brief = taskInput.value.trim();

      if (!email || email.length > 254 || !EMAIL_REGEX.test(email)) {
        showError('Please enter a valid email address.');
        emailInput.focus();
        return;
      }

      if (!brief) {
        showError('Please describe the workflow.');
        taskInput.focus();
        return;
      }

      if (!budgetHidden.value) {
        showError('Please select a budget range.');
        return;
      }

      // Disable button
      submitBtn.disabled = true;
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = 'Sending\u2026';

      try {
        const fields: Record<string, string> = {};
        if (brief) fields.brief = brief;
        if (budgetHidden.value) fields.budget = budgetHidden.value;

        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, tag: 'hire', fields }),
        });

        const data = await response.json();

        if (response.ok) {
          // Show success
          if (formSection) formSection.hidden = true;
          if (successSection) successSection.hidden = false;
        } else {
          showError(data.message || 'Something went wrong. Please try again.');
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      } catch {
        showError('Network error. Please try again.');
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHireForm);
  } else {
    initHireForm();
  }

  document.addEventListener('astro:page-load', initHireForm);
</script>

<style>
  /* =========================================
   * HIRE PAGE — Earned-Ask Layout
   *
   * 5-zone structure: hook → packages → process → CTA+form → fallback
   * Each zone earns the right to the next.
   * Form sits behind credibility. The ask feels justified.
   * ========================================= */

  /* ---- Content wrapper ---- */
  .hire__content {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: var(--space-20);
  }

  /* Reset fp-section top padding — wrapper gap handles spacing */
  .hire__content > .fp-section {
    padding-top: 0;
  }

  /* First section keeps top padding for logo clearance */
  .hire__content > .fp-section:first-child {
    padding-top: var(--space-16);
  }

  .hire__content[hidden] {
    display: none;
  }

  /* ---- Hero CTA ---- */
  .hire__hero-cta {
    margin-top: var(--space-4);
    align-self: flex-start;
  }

  /* ---- Scarcity line (extracted for visual weight) ---- */
  .hire__scarcity {
    font-family: var(--font-mono);
    font-size: var(--text-2xs);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-accent);
    margin-bottom: var(--space-4);
  }

  /* ---- Proof strip (HIGH density moment) ---- */
  .hire__proof {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: calc(-1 * var(--space-4));
    margin-bottom: var(--space-4);
    padding: var(--space-4) 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  .hire__proof-item {
    font-family: var(--font-mono);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-fg-muted);
  }

  .hire__proof-pipe {
    width: 1px;
    height: 12px;
    background: var(--color-border);
  }

  /* ---- Tier packages (MEDIUM density) ---- */
  .hire__tiers {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    width: 100%;
  }

  .hire__tier {
    cursor: default;
  }

  .hire__tier:hover {
    transform: none;
    box-shadow: none;
    border-color: var(--color-border);
    background: var(--color-bg-elevated);
  }

  .hire__tier--featured {
    border-left: 2px solid var(--color-accent);
  }

  .hire__tier-label {
    font-family: var(--font-mono);
    font-size: var(--text-2xs);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-fg-muted);
  }

  .hire__tier-name {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
  }

  .hire__tier-price {
    font-family: var(--font-mono);
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: var(--color-accent);
  }

  .hire__tier-scope {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-secondary);
    line-height: var(--leading-relaxed);
  }

  .hire__tier-example {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    font-style: italic;
  }

  .hire__tier-delivery {
    font-family: var(--font-mono);
    font-size: var(--text-2xs);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-fg-muted);
  }

  /* ---- Primary CTA (Signal-fill — one per page) ---- */
  .hire__cta-primary {
    margin-bottom: var(--space-6);
    align-self: flex-start;
  }

  /* ---- Process steps (LOW density, The Index) ---- */
  .hire__steps {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    width: 100%;
  }

  .hire__step {
    display: flex;
    gap: var(--space-4);
    align-items: flex-start;
  }

  .hire__step-num {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-accent);
    letter-spacing: 0.05em;
    flex-shrink: 0;
    padding-top: 2px;
  }

  .hire__step-body {
    flex: 1;
  }

  .hire__step-title {
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin-bottom: var(--space-1);
  }

  .hire__step-desc {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    line-height: var(--leading-relaxed);
  }

  /* ---- Form ---- */
  .hire__form {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    width: 100%;
  }

  .hire__textarea {
    height: auto;
    min-height: 120px;
    padding-top: var(--space-3);
    padding-bottom: var(--space-3);
    resize: vertical;
    line-height: var(--leading-relaxed);
  }

  /* ---- Budget button group ---- */
  .hire__budget-group {
    width: 100%;
  }

  .hire__budget-label {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    margin-bottom: var(--space-3);
  }

  .hire__budget-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-3);
  }

  .hire__budget-btn {
    padding: var(--space-3) var(--space-4);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--color-fg-secondary);
    background: var(--color-bg-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    text-align: center;
    transition:
      border-color 100ms var(--ease-sharp),
      background-color 150ms var(--ease-out),
      color 150ms var(--ease-out);
    -webkit-tap-highlight-color: transparent;
  }

  .hire__budget-btn:hover {
    border-color: var(--color-accent);
    color: var(--color-fg);
    background: color-mix(in oklch, var(--color-accent) 4%, var(--color-bg-elevated));
  }

  .hire__budget-btn[aria-pressed="true"] {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: color-mix(in oklch, var(--color-accent) 8%, var(--color-bg-elevated));
  }

  .hire__budget-btn:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .hire__error {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-error);
    margin-top: calc(-1 * var(--space-3));
  }

  .hire__error[hidden] {
    display: none;
  }

  /* ---- Fallback CTA (LOW density exit ramp) ---- */
  .hire__fallback {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--color-fg-muted);
    letter-spacing: 0.02em;
    text-align: center;
  }

  .hire__fallback-link {
    color: var(--color-accent);
    text-decoration: underline;
    text-underline-offset: 3px;
    text-decoration-thickness: 1px;
    transition: color var(--duration-fast);
  }

  .hire__fallback-link:hover {
    color: var(--color-fg);
  }

  /* ---- Success state ---- */
  .hire__back-link {
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--color-fg-muted);
    text-decoration: none;
    transition: color var(--duration-fast);
  }

  .hire__back-link:hover {
    color: var(--color-accent);
  }

  /* ---- Smooth scroll for anchor link ---- */
  :global(html) {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    :global(html) {
      scroll-behavior: auto;
    }
  }

  /* ---- Responsive ---- */
  @media (max-width: 767px) {
    .hire__content {
      gap: var(--space-14);
    }

    .hire__content > .fp-section:first-child {
      padding-top: var(--space-6);
    }

    /* Compress proof strip on mobile */
    .hire__proof {
      border-top: none;
      border-bottom: none;
      padding: 0;
      margin-top: 0;
      margin-bottom: var(--space-3);
      gap: 4px 8px;
    }

    .hire__proof-pipe {
      display: none;
    }

    .hire__proof-item {
      font-size: 10px;
    }

    /* CTAs stretch full-width on mobile */
    .hire__hero-cta {
      width: 100%;
      text-align: center;
    }

    .hire__cta-primary {
      width: 100%;
      text-align: center;
    }

    .hire__form [data-hire-submit] {
      width: 100%;
    }

    /* Progressive disclosure: strip supporting text on mobile */
    .hire__step-desc {
      display: none;
    }

    .hire__steps {
      gap: var(--space-5);
    }

    .hire__form {
      gap: var(--space-4);
    }

    .hire__textarea {
      min-height: 80px;
    }
  }

  @media (max-width: 480px) {
    .hire__content {
      gap: var(--space-10);
    }

    .hire__budget-grid {
      grid-template-columns: 1fr;
    }
  }

  /* ---- Reduced motion ---- */
  @media (prefers-reduced-motion: reduce) {
    .hire__budget-btn {
      transition: none;
    }
  }
</style>
