---
/**
 * Plugins Directory
 * ch47 design system — now using shared BaseLayout and design tokens.
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout
  title="Plugins — channel47"
  description="Claude Code plugins built by a media buyer, not a prompt engineer. Tools that do real work on real accounts."
>
  <main class="pg">
    <!-- =======================================
         ACT 1: HERO (LOW density)
         Sparse. Commanding. One thought.
         ======================================= -->
    <section class="hero" data-section="hero">
      <Nav currentPath="/plugins" />

      <div class="hero__content">
        <div class="hero__bar" aria-hidden="true"></div>
        <p class="label">PLUGINS / DIRECTORY</p>
        <h1 class="hero__headline" id="hero-headline">
          Tools that do<br />the work.
        </h1>
        <p class="hero__sub">
          Claude Code plugins built from managing real ad spend on real accounts. Not demos. Not proofs of concept. Production tools that caught a $3K/month keyword gap and flagged pacing issues before clients noticed.
        </p>
      </div>
    </section>

    <!-- =======================================
         ACT 2: STATS BAR (HIGH density)
         Dense, quiet credibility strip.
         ======================================= -->
    <section class="stats" data-section="stats">
      <div class="stats__item">
        <span class="stats__value">1</span>
        <span class="stats__label">PLUGIN SHIPPED</span>
      </div>
      <div class="stats__pipe" aria-hidden="true"></div>
      <div class="stats__item">
        <span class="stats__value">25+</span>
        <span class="stats__label">ACCOUNTS MANAGED</span>
      </div>
      <div class="stats__pipe" aria-hidden="true"></div>
      <div class="stats__item">
        <span class="stats__value">v2.5</span>
        <span class="stats__label">CURRENT VERSION</span>
      </div>
      <div class="stats__pipe" aria-hidden="true"></div>
      <div class="stats__item">
        <span class="stats__value">MIT</span>
        <span class="stats__label">LICENSE</span>
      </div>
    </section>

    <!-- =======================================
         ACT 3: PLUGIN CARD (MEDIUM density)
         The main event. Asymmetric two-panel.
         ======================================= -->
    <section class="plugins" data-section="plugins">
      <div class="plugins__grid">
        <div class="plugins__card plugins__card--primary">
          <div class="plugins__card-bar" aria-hidden="true"></div>
          <span class="label">047.ADS</span>
          <h2 class="plugins__title">Google Ads</h2>
          <p class="plugins__version">v2.5.0</p>
          <p class="plugins__desc">
            Campaign creation and optimization with PMax, Search, and Audit skills plus research agents. Connects to the Google Ads API via MCP, runs GAQL queries, and does the Monday morning checklist before Monday morning.
          </p>
          <div class="plugins__tags">
            <span class="tag">google-ads</span>
            <span class="tag">mcp</span>
            <span class="tag">gaql</span>
          </div>
          <div class="plugins__meta">
            <span>Jackson</span>
            <span class="meta__pipe" aria-hidden="true"></span>
            <span>MIT License</span>
            <span class="meta__pipe" aria-hidden="true"></span>
            <a href="https://github.com/channel47/channel47" class="plugins__link">GitHub →</a>
          </div>
        </div>

        <div class="plugins__card plugins__card--secondary">
          <span class="label">STATUS</span>
          <div class="plugins__status">
            <div class="status__row">
              <span class="status__dot status__dot--active"></span>
              <span class="status__text">MCP Server</span>
              <span class="status__val">Connected</span>
            </div>
            <div class="status__row">
              <span class="status__dot status__dot--active"></span>
              <span class="status__text">Search Skills</span>
              <span class="status__val">Shipped</span>
            </div>
            <div class="status__row">
              <span class="status__dot status__dot--active"></span>
              <span class="status__text">PMax Skills</span>
              <span class="status__val">Shipped</span>
            </div>
            <div class="status__row">
              <span class="status__dot status__dot--active"></span>
              <span class="status__text">Audit Skills</span>
              <span class="status__val">Shipped</span>
            </div>
            <div class="status__row">
              <span class="status__dot status__dot--building"></span>
              <span class="status__text">Agent Loop</span>
              <span class="status__val status__val--building">Building</span>
            </div>
          </div>
          <div class="plugins__install">
            <span class="label" style="margin-bottom: 8px;">INSTALL</span>
            <code class="plugins__cmd">git clone channel47/channel47</code>
          </div>
        </div>
      </div>
    </section>

    <!-- =======================================
         ACT 4: RUPTURE (Light inversion)
         Density shift + surface flip.
         The manifesto moment.
         ======================================= -->
    <section class="rupture" data-section="rupture">
      <div class="rupture__bar" aria-hidden="true"></div>
      <div class="rupture__content">
        <span class="label rupture__label">047 / BUILDING IN PUBLIC</span>
        <h2 class="rupture__headline">
          Most plugins are built by developers who've never run an ad account.
        </h2>
        <p class="rupture__body">
          I've managed Google Ads across 25+ accounts. The tools I needed didn't exist, so I built them. Every skill in this plugin comes from a real workflow on a real account with real money at stake. The agent loop I'm building next will handle the audit-decide-execute-report cycle that eats most of a media buyer's week.
        </p>
        <p class="rupture__body">
          This is open source because the best tools should be. Follow the build on Substack. Everything ships in public.
        </p>
      </div>
    </section>

    <!-- =======================================
         ACT 5: COMING NEXT (MEDIUM density)
         Terminal-style sequential reveal.
         ======================================= -->
    <section class="roadmap" data-section="roadmap">
      <div class="roadmap__header">
        <div class="hero__bar" aria-hidden="true"></div>
        <span class="label">ROADMAP</span>
        <h2 class="roadmap__title">What's next</h2>
      </div>
      <div class="roadmap__list" id="roadmap-list">
        <div class="roadmap__item">
          <span class="roadmap__idx">001</span>
          <span class="roadmap__text">Full agent loop (audit → decide → execute → report)</span>
          <span class="roadmap__status roadmap__status--active">IN PROGRESS</span>
        </div>
        <div class="roadmap__item">
          <span class="roadmap__idx">002</span>
          <span class="roadmap__text">Multi-account MCC scanning</span>
          <span class="roadmap__status">PLANNED</span>
        </div>
        <div class="roadmap__item">
          <span class="roadmap__idx">003</span>
          <span class="roadmap__text">Automated search term reports + negative keyword builds</span>
          <span class="roadmap__status">PLANNED</span>
        </div>
        <div class="roadmap__item">
          <span class="roadmap__idx">004</span>
          <span class="roadmap__text">Pacing alerts and budget guardrails</span>
          <span class="roadmap__status">PLANNED</span>
        </div>
        <div class="roadmap__item">
          <span class="roadmap__idx">005</span>
          <span class="roadmap__text">More plugins. Different domains. Same approach.</span>
          <span class="roadmap__status">SOMEDAY</span>
        </div>
      </div>
    </section>

    <!-- =======================================
         ACT 6: CTA (LOW density, The Void)
         One element. Maximum space.
         ======================================= -->
    <section class="cta" data-section="cta">
      <p class="label">TRANSMITTING</p>
      <a href="/#signup" class="cta__link">Get the build notes</a>
      <p class="cta__sub">Short emails when something real ships.</p>
    </section>

    <!-- Footer -->
    <Footer />
  </main>

  <!-- =======================================
       MOTION: Scroll reveals + Hero sequence + Glitch
       ======================================= -->
  <script>
    // Respect reduced motion
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    if (prefersReduced) {
      document.querySelectorAll('[data-section]').forEach(el => el.classList.add('is-visible'));
    } else {
      // Hero sequence choreography
      (function heroSequence() {
        const hero = document.querySelector('[data-section="hero"]');
        if (!hero) return;
        hero.classList.add('is-visible');

        // Auto-glitch the headline after it fades in
        const headline = document.getElementById('hero-headline');
        if (!headline) return;

        let glitched = false;
        setTimeout(() => {
          if (glitched) return;
          glitched = true;
          triggerGlitch(headline);
        }, 1100); // 400ms delay + 700ms fade
      })();

      // Scroll reveal for other sections
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15, rootMargin: '0px 0px -40px 0px' }
      );

      document.querySelectorAll('[data-section]:not([data-section="hero"])').forEach(el => {
        observer.observe(el);
      });
    }

    // Glitch function
    function triggerGlitch(el: HTMLElement) {
      const offsets = [
        { x: -3, y: 1 }, { x: 2, y: -1 },
        { x: -1, y: 2 }, { x: 1, y: -1 }, { x: 0, y: 0 },
      ];
      let start: number | null = null;

      function step(ts: number) {
        if (!start) start = ts;
        const elapsed = ts - start;
        if (elapsed > 160) {
          el.style.transform = 'translate(0, 0)';
          el.classList.remove('glitching');
          return;
        }
        const frame = offsets[Math.floor(elapsed / 35) % offsets.length];
        el.style.transform = `translate(${frame.x}px, ${frame.y}px)`;
        el.classList.add('glitching');
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // Hover glitch on headline
    const headline = document.getElementById('hero-headline');
    if (headline && !prefersReduced) {
      let glitchCooldown = false;
      headline.addEventListener('mouseenter', () => {
        if (glitchCooldown) return;
        glitchCooldown = true;
        triggerGlitch(headline);
        setTimeout(() => { glitchCooldown = false; }, 500);
      });
    }

    // Sequential reveal for roadmap items
    if (!prefersReduced) {
      const roadmapSection = document.querySelector('[data-section="roadmap"]');
      const roadmapItems = document.querySelectorAll('.roadmap__item');

      if (roadmapSection && roadmapItems.length) {
        const roadmapObs = new IntersectionObserver(
          ([entry]) => {
            if (entry.isIntersecting) {
              roadmapObs.disconnect();
              let i = 0;
              function revealNext() {
                if (i >= roadmapItems.length) return;
                roadmapItems[i].classList.add('is-visible');
                i++;
                setTimeout(revealNext, 120 + Math.random() * 80);
              }
              setTimeout(revealNext, 400);
            }
          },
          { threshold: 0.3 }
        );
        roadmapObs.observe(roadmapSection);
      }
    }
  </script>
</BaseLayout>

<style>
  /* ========================================
   * Plugins page — scoped styles using shared tokens
   * ======================================== */

  a { color: inherit; text-decoration: none; }

  /* ---- Labels (Broadcast) ---- */
  .label {
    font-family: var(--font-mono);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-fg-muted);
    display: block;
  }

  /* ---- Tags ---- */
  .tag {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.05em;
    color: var(--color-fg-secondary);
    padding: 4px 10px;
    border: 1px solid var(--color-border);
    border-radius: 2px;
  }

  /* ---- Hero ---- */
  .hero {
    min-height: 90vh;
    min-height: 90dvh;
    display: flex;
    flex-direction: column;
    padding: 0 clamp(24px, 5vw, 64px);
  }

  .hero__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding-bottom: clamp(60px, 10vh, 100px);
  }

  /* Accent bar: draw-in animation */
  .hero__bar {
    width: 0;
    height: 2px;
    background-color: var(--color-accent);
    margin-bottom: 24px;
  }

  [data-section="hero"].is-visible .hero__bar {
    animation: drawH 600ms var(--ease-out) 200ms forwards;
  }

  @keyframes drawH {
    to { width: 40px; }
  }

  /* Hero label */
  .hero__content > .label {
    opacity: 0;
    margin-bottom: 20px;
  }

  [data-section="hero"].is-visible .hero__content > .label {
    animation: fadeIn 200ms var(--ease-out) 300ms forwards;
  }

  /* Hero headline */
  .hero__headline {
    font-family: var(--font-display);
    font-size: clamp(2.75rem, 8vw, 6rem);
    line-height: 0.92;
    letter-spacing: -0.04em;
    font-weight: 600;
    color: #F5F0EB;
    max-width: 800px;
    opacity: 0;
    cursor: default;
    position: relative;
    display: inline-block;
  }

  [data-section="hero"].is-visible .hero__headline {
    animation: fadeUp 700ms var(--ease-out) 400ms forwards;
  }

  /* Hero sub */
  .hero__sub {
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    max-width: 480px;
    margin-top: 32px;
    opacity: 0;
  }

  [data-section="hero"].is-visible .hero__sub {
    animation: fadeUp 400ms var(--ease-out) 700ms forwards;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }

  /* ---- Stats Bar (HIGH density) ---- */
  .stats {
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
    padding: 20px clamp(24px, 5vw, 64px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: clamp(16px, 3vw, 40px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .stats.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .stats__item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .stats__value {
    font-family: var(--font-display);
    font-size: clamp(1.25rem, 2.5vw, 1.75rem);
    font-weight: 600;
    letter-spacing: -0.02em;
    color: #F5F0EB;
  }

  .stats__label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-border);
  }

  .stats__pipe {
    width: 1px;
    height: 24px;
    background: var(--color-border);
  }

  /* ---- Plugin Cards (MEDIUM density) ---- */
  .plugins {
    padding: 0;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .plugins.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .plugins__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1px;
    background-color: var(--color-border);
  }

  @media (min-width: 768px) {
    .plugins__grid {
      grid-template-columns: 3fr 2fr;
    }
  }

  .plugins__card {
    padding: clamp(32px, 5vh, 56px) clamp(24px, 4vw, 48px);
  }

  .plugins__card--primary {
    background-color: var(--color-bg-elevated);
    min-height: 380px;
    display: flex;
    flex-direction: column;
  }

  .plugins__card--secondary {
    background-color: var(--color-bg-surface);
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .plugins__card-bar {
    width: 0;
    height: 2px;
    background-color: var(--color-accent);
    margin-bottom: 24px;
  }

  .plugins.is-visible .plugins__card-bar {
    animation: drawH 400ms var(--ease-out) 200ms forwards;
  }

  .plugins__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 3vw, 2.5rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: #F5F0EB;
    margin-top: 12px;
  }

  .plugins__version {
    font-size: 13px;
    color: var(--color-fg-muted);
    margin-top: 4px;
  }

  .plugins__desc {
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-secondary);
    margin-top: 20px;
    max-width: 480px;
    flex: 1;
  }

  .plugins__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 24px;
  }

  .plugins__meta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
    font-size: 12px;
    color: var(--color-fg-muted);
  }

  .meta__pipe {
    width: 1px;
    height: 12px;
    background: var(--color-border);
  }

  .plugins__link {
    color: var(--color-accent);
    transition: color var(--duration-fast);
  }

  .plugins__link:hover {
    color: #F5F0EB;
  }

  /* Status panel */
  .plugins__status {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .status__row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
  }

  .status__dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .status__dot--active { background-color: #22C55E; }
  .status__dot--building { background-color: var(--color-accent); }

  .status__text {
    color: var(--color-fg-secondary);
    flex: 1;
  }

  .status__val {
    color: var(--color-fg-muted);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .status__val--building { color: var(--color-accent); }

  /* Install block */
  .plugins__install {
    margin-top: auto;
    display: flex;
    flex-direction: column;
  }

  .plugins__cmd {
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--color-fg);
    background: var(--color-bg-elevated);
    padding: 10px 14px;
    border: 1px solid var(--color-border);
    border-radius: 2px;
    user-select: all;
  }

  /* ---- Rupture (Light inversion) ---- */
  .rupture {
    background-color: #FAF7F2;
    color: #1C1917;
    padding: clamp(80px, 14vh, 140px) clamp(24px, 5vw, 64px);
    position: relative;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .rupture.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .rupture__bar {
    position: absolute;
    left: clamp(24px, 5vw, 64px);
    top: clamp(80px, 14vh, 140px);
    width: 2px;
    height: 0;
    background-color: var(--color-accent);
  }

  .rupture.is-visible .rupture__bar {
    animation: drawV 600ms var(--ease-out) 200ms forwards;
  }

  @keyframes drawV {
    to { height: 40px; }
  }

  .rupture__content {
    max-width: 600px;
    margin-left: clamp(0px, 8%, 120px);
  }

  .rupture__label {
    color: var(--color-fg-muted);
    margin-bottom: 24px;
  }

  .rupture__headline {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 4vw, 2.75rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: #1C1917;
  }

  .rupture__body {
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--color-fg-muted);
    margin-top: 20px;
    letter-spacing: 0.02em;
  }

  /* ---- Roadmap ---- */
  .roadmap {
    padding: clamp(60px, 10vh, 100px) clamp(24px, 5vw, 64px);
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .roadmap.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .roadmap__header {
    margin-bottom: 40px;
  }

  .roadmap__header .hero__bar {
    width: 0;
  }

  .roadmap.is-visible .roadmap__header .hero__bar {
    animation: drawH 400ms var(--ease-out) 200ms forwards;
  }

  .roadmap__header .label {
    margin-top: 20px;
  }

  .roadmap__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1.1;
    color: #F5F0EB;
    margin-top: 12px;
  }

  .roadmap__list {
    display: flex;
    flex-direction: column;
  }

  .roadmap__item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px 0;
    border-bottom: 1px solid var(--color-border);
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 300ms var(--ease-out),
                transform 300ms var(--ease-out);
  }

  .roadmap__item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .roadmap__idx {
    font-size: 11px;
    color: var(--color-border);
    letter-spacing: 0.1em;
    flex-shrink: 0;
    width: 32px;
  }

  .roadmap__text {
    font-size: clamp(0.875rem, 1.5vw, 1rem);
    color: var(--color-fg);
    flex: 1;
    min-width: 0;
  }

  .roadmap__status {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-fg-muted);
    flex-shrink: 0;
    text-align: right;
  }

  .roadmap__status--active { color: var(--color-accent); }

  /* ---- CTA (LOW density, The Void) ---- */
  .cta {
    padding: clamp(100px, 16vh, 200px) clamp(24px, 5vw, 64px);
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 400ms var(--ease-out),
                transform 400ms var(--ease-out);
  }

  .cta.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .cta > .label {
    margin-bottom: 24px;
  }

  .cta__link {
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 500;
    color: #F5F0EB;
    text-decoration: underline;
    text-underline-offset: 10px;
    text-decoration-color: var(--color-accent);
    text-decoration-thickness: 2px;
    transition: color var(--duration-fast);
  }

  .cta__link:hover { color: var(--color-accent); }

  .cta__sub {
    margin-top: 16px;
    font-size: 13px;
    color: var(--color-fg-muted);
  }

  /* ---- Reduced Motion ---- */
  @media (prefers-reduced-motion: reduce) {
    [data-section],
    .roadmap__item {
      opacity: 1 !important;
      transform: none !important;
    }

    .hero__bar,
    .plugins__card-bar,
    .rupture__bar {
      width: 40px !important;
      height: auto !important;
    }

    .rupture__bar { height: 40px !important; width: 2px !important; }
  }

  /* ---- Responsive ---- */
  @media (max-width: 640px) {
    .stats {
      flex-direction: column;
      gap: 16px;
    }

    .stats__pipe { display: none; }

    .roadmap__status {
      display: none;
    }

    .roadmap__text {
      font-size: 14px;
    }
  }
</style>
