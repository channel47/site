---
/**
 * Blog Listing Page
 *
 * Editorial-style blog index with refined typography and layout.
 */

import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import PageHeader from '../../components/PageHeader.astro';
import EmailSignup from '../../components/EmailSignup.astro';

// Fetch posts from content collection
const posts = (await getCollection('posts'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const formatDate = (date: Date) =>
  new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);

// Separate featured post (most recent) from the rest
const [featuredPost, ...remainingPosts] = posts;
---

<BaseLayout title="Blog" description="Insights on AI tools, Google Ads automation, and MCP skills.">
  <Header />

  <main class="blog-page">
    <!-- Header -->
    <PageHeader
      title="Blog"
      description="Insights on building with AI, automating Google Ads, and packaging expertise into MCP skills."
      label="Writing"
    />

    {posts.length > 0 ? (
      <>
        <!-- Featured Post -->
        {featuredPost && (
          <section class="featured-section">
            <a href={`/blog/${featuredPost.slug}`} class="featured-post">
              <div class="featured-post__content">
                <span class="featured-post__label">Latest</span>
                <h2 class="featured-post__title">{featuredPost.data.title}</h2>
                {featuredPost.data.description && (
                  <p class="featured-post__description">{featuredPost.data.description}</p>
                )}
                <div class="featured-post__meta">
                  <time datetime={featuredPost.data.date.toISOString()}>
                    {formatDate(featuredPost.data.date)}
                  </time>
                  {featuredPost.data.tags && featuredPost.data.tags.length > 0 && (
                    <span class="featured-post__tag">{featuredPost.data.tags[0]}</span>
                  )}
                </div>
              </div>
              <span class="featured-post__arrow">&rarr;</span>
            </a>
          </section>
        )}

        <!-- Post List -->
        {remainingPosts.length > 0 && (
          <section class="posts-section">
            <div class="posts-list">
              {remainingPosts.map((post, index) => (
                <a href={`/blog/${post.slug}`} class="post-item" style={`animation-delay: ${index * 50}ms`}>
                  <div class="post-item__date">
                    <time datetime={post.data.date.toISOString()}>
                      {formatDate(post.data.date)}
                    </time>
                  </div>
                  <div class="post-item__content">
                    <h3 class="post-item__title">{post.data.title}</h3>
                    {post.data.description && (
                      <p class="post-item__description">{post.data.description}</p>
                    )}
                  </div>
                  <span class="post-item__arrow">&rarr;</span>
                </a>
              ))}
            </div>
          </section>
        )}
      </>
    ) : (
      <div class="blog-empty">
        <p>No posts yet. Check back soon.</p>
      </div>
    )}

    <!-- Subscribe Section -->
    <section class="subscribe-section">
      <div class="subscribe-section__content">
        <h2 class="subscribe-section__title">Stay updated</h2>
        <p class="subscribe-section__description">New posts on AI tools and MCP skills. No spam.</p>
        <EmailSignup buttonText="Subscribe" tag="blog-listing" />
      </div>
    </section>

    <!-- Archive Link -->
    <nav class="blog-nav">
      <a href="/archive/blog" class="blog-nav__link">
        <span>View older posts</span>
        <span class="blog-nav__arrow">&rarr;</span>
      </a>
    </nav>
  </main>

  <Footer />
</BaseLayout>

<style>
  .blog-page {
    display: flex;
    flex-direction: column;
  }

  /* ========================================
   * Header
   * ======================================== */

  /* ========================================
   * Featured Post
   * ======================================== */

  .featured-section {
    padding: 0 var(--padding-mobile);
    max-width: var(--container-lg);
    margin: 0 auto var(--space-8);
    width: 100%;
  }

  @media (min-width: 768px) {
    .featured-section {
      padding: 0 var(--padding-desktop);
      margin-bottom: var(--space-12);
    }
  }

  .featured-post {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-4);
    padding: var(--space-6);
    background: var(--color-bg-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    text-decoration: none;
    color: inherit;
    transition: var(--card-transition);
  }

  @media (min-width: 768px) {
    .featured-post {
      padding: var(--space-8);
    }
  }

  .featured-post:hover {
    transform: translateY(var(--card-hover-lift));
    border-color: var(--color-accent);
    box-shadow: var(--card-hover-shadow), var(--card-hover-glow);
  }

  .featured-post__content {
    flex: 1;
  }

  .featured-post__label {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-sans);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
    margin-bottom: var(--space-3);
    padding: var(--space-1) var(--space-3);
    background: var(--color-accent-subtle);
    border-radius: var(--radius-full);
  }

  .featured-post__title {
    font-family: var(--font-sans);
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin-bottom: var(--space-2);
    line-height: var(--leading-snug);
  }

  @media (min-width: 768px) {
    .featured-post__title {
      font-size: var(--text-2xl);
    }
  }

  .featured-post__description {
    font-family: var(--font-serif);
    font-size: var(--text-base);
    color: var(--color-fg-secondary);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-4);
    max-width: 60ch;
  }

  @media (min-width: 768px) {
    .featured-post__description {
      font-size: var(--text-lg);
    }
  }

  .featured-post__meta {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
  }

  .featured-post__tag {
    padding: var(--space-1) var(--space-2);
    background: var(--color-bg);
    border-radius: var(--radius-sm);
    text-transform: lowercase;
  }

  .featured-post__arrow {
    font-family: var(--font-mono);
    font-size: var(--text-xl);
    color: var(--color-fg-muted);
    transition: transform var(--duration-fast) var(--ease-spring);
  }

  .featured-post:hover .featured-post__arrow {
    transform: translateX(4px);
    color: var(--color-accent);
  }

  /* ========================================
   * Post List
   * ======================================== */

  .posts-section {
    padding: 0 var(--padding-mobile);
    max-width: var(--container-lg);
    margin: 0 auto var(--space-12);
    width: 100%;
  }

  @media (min-width: 768px) {
    .posts-section {
      padding: 0 var(--padding-desktop);
      margin-bottom: var(--space-16);
    }
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--color-border-subtle);
  }

  .post-item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-4);
    padding: var(--space-5) 0;
    border-bottom: 1px solid var(--color-border-subtle);
    text-decoration: none;
    color: inherit;
    transition:
      background-color var(--duration-fast) var(--ease-out),
      padding var(--duration-fast) var(--ease-out);
  }

  @media (min-width: 640px) {
    .post-item {
      grid-template-columns: 140px 1fr auto;
      align-items: flex-start;
      gap: var(--space-6);
      padding: var(--space-6) var(--space-4);
      margin: 0 calc(-1 * var(--space-4));
      border-radius: var(--radius-lg);
      border-bottom: none;
    }

    .post-item + .post-item {
      border-top: 1px solid var(--color-border-subtle);
      border-radius: 0;
    }

    .post-item:first-child {
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .post-item:last-child {
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }

    .post-item:only-child {
      border-radius: var(--radius-lg);
    }
  }

  .post-item:hover {
    background-color: var(--color-bg-elevated);
  }

  @media (min-width: 640px) {
    .post-item:hover {
      padding-left: var(--space-5);
      padding-right: var(--space-5);
    }
  }

  .post-item__date {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    padding-top: var(--space-1);
    order: 2;
  }

  @media (min-width: 640px) {
    .post-item__date {
      order: 0;
      text-align: right;
    }
  }

  .post-item__content {
    order: 1;
  }

  @media (min-width: 640px) {
    .post-item__content {
      order: 0;
    }
  }

  .post-item__title {
    font-family: var(--font-sans);
    font-size: var(--text-base);
    font-weight: var(--font-medium);
    color: var(--color-fg);
    margin-bottom: var(--space-1);
    line-height: var(--leading-snug);
    transition: color var(--duration-fast) var(--ease-out);
  }

  @media (min-width: 768px) {
    .post-item__title {
      font-size: var(--text-lg);
    }
  }

  .post-item:hover .post-item__title {
    color: var(--color-accent);
  }

  .post-item__description {
    font-family: var(--font-serif);
    font-size: var(--text-sm);
    color: var(--color-fg-secondary);
    line-height: var(--leading-relaxed);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (min-width: 768px) {
    .post-item__description {
      font-size: var(--text-base);
    }
  }

  .post-item__arrow {
    display: none;
    font-family: var(--font-mono);
    color: var(--color-fg-muted);
    transition: transform var(--duration-fast) var(--ease-spring);
    align-self: center;
  }

  @media (min-width: 640px) {
    .post-item__arrow {
      display: block;
    }
  }

  .post-item:hover .post-item__arrow {
    transform: translateX(4px);
    color: var(--color-accent);
  }

  /* ========================================
   * Empty State
   * ======================================== */

  .blog-empty {
    text-align: center;
    color: var(--color-fg-muted);
    padding: var(--space-20) var(--padding-mobile);
    font-family: var(--font-serif);
    font-style: italic;
  }

  /* ========================================
   * Subscribe Section
   * ======================================== */

  .subscribe-section {
    padding: var(--space-10) var(--padding-mobile);
    border-top: 1px solid var(--color-border-subtle);
  }

  @media (min-width: 768px) {
    .subscribe-section {
      padding: var(--space-12) var(--padding-desktop);
    }
  }

  .subscribe-section__content {
    max-width: var(--container-sm);
    margin: 0 auto;
    text-align: center;
  }

  .subscribe-section__title {
    font-family: var(--font-sans);
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin-bottom: var(--space-2);
  }

  .subscribe-section__description {
    font-family: var(--font-serif);
    font-size: var(--text-base);
    color: var(--color-fg-secondary);
    margin-bottom: var(--space-6);
  }

  /* ========================================
   * Navigation
   * ======================================== */

  .blog-nav {
    padding: var(--space-6) var(--padding-mobile) var(--space-12);
    text-align: center;
  }

  @media (min-width: 768px) {
    .blog-nav {
      padding: var(--space-6) var(--padding-desktop) var(--space-16);
    }
  }

  .blog-nav__link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--color-fg-muted);
    text-decoration: none;
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-md);
    transition:
      color var(--duration-fast) var(--ease-out),
      background-color var(--duration-fast) var(--ease-out);
  }

  .blog-nav__link:hover {
    color: var(--color-fg-secondary);
    background-color: var(--color-bg-elevated);
  }

  .blog-nav__arrow {
    transition: transform var(--duration-fast) var(--ease-spring);
  }

  .blog-nav__link:hover .blog-nav__arrow {
    transform: translateX(3px);
  }
</style>
