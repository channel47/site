---
/**
 * /subscribe — Newsletter signup
 * The Void. Logo, accent bar, pitch, form. Nothing else.
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import LogoAnimated from '../components/LogoAnimated.astro';
import EmailSignup from '../components/EmailSignup.astro';
---

<BaseLayout
  title="Build Notes — Channel 47"
  description="Skills, breakdowns, and build process. Weekly when something ships."
>
  <main id="main-content" class="min-h-dvh flex items-center p-[clamp(24px,5vw,64px)]">
    <div class="flex flex-col items-start max-w-[480px] w-full">
      <a href="/" class="mb-8" aria-label="Back to Channel 47">
        <LogoAnimated />
      </a>
      <div class="subscribe__bar w-0 h-0.5 bg-signal mb-6" aria-hidden="true"></div>
      <p class="label mb-4 opacity-0 subscribe__label">BUILD NOTES</p>
      <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold tracking-tight leading-[1.1] text-chalk mb-3 opacity-0 subscribe__headline" style="font-family: var(--font-family-display);">Get the emails.</h1>
      <p class="font-mono text-sm leading-relaxed text-dust max-w-[38ch] mb-12 opacity-0 subscribe__pitch">Skills, breakdowns, and build process. Weekly when something ships.</p>
      <div class="w-full opacity-0 subscribe__form">
        <EmailSignup
          placeholder="you@domain.com"
          tag="subscribe"
          submitText="Subscribe"
          variant="prominent"
        />
      </div>
    </div>
  </main>
</BaseLayout>

<script>
  const params = new URLSearchParams(window.location.search);
  if (params.get('ref') === 'build') {
    const form = document.querySelector('[data-signup-form]') as HTMLElement;
    if (form) {
      form.dataset.tag = 'build';

      const role = params.get('role');
      const task = params.get('task');
      const tool = params.get('tool');
      const fields: Record<string, string> = {};
      if (role) fields.build_role = role;
      if (task) fields.build_task = task;
      if (tool) fields.build_tool = tool;

      if (Object.keys(fields).length > 0) {
        form.dataset.fields = JSON.stringify(fields);
      }
    }

    window.history.replaceState({}, '', '/subscribe');
  }
</script>

<style>
  .subscribe__bar {
    animation: subscribe-bar-draw 500ms var(--ease-out) 150ms forwards,
               breathing-glow 3s ease-in-out 700ms infinite;
  }
  .subscribe__label {
    animation: subscribe-fade-in 400ms var(--ease-out) 450ms forwards;
  }
  .subscribe__headline {
    animation: subscribe-fade-in 400ms var(--ease-out) 550ms forwards;
  }
  .subscribe__pitch {
    animation: subscribe-fade-in 400ms var(--ease-out) 650ms forwards;
  }
  .subscribe__form {
    animation: subscribe-rise 500ms var(--ease-out) 850ms forwards;
  }

  @keyframes subscribe-bar-draw {
    from { width: 0; opacity: 0.5; }
    to { width: 40px; opacity: 1; }
  }
  @keyframes subscribe-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes subscribe-rise {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (prefers-reduced-motion: reduce) {
    .subscribe__bar,
    .subscribe__label,
    .subscribe__headline,
    .subscribe__pitch,
    .subscribe__form {
      animation: none;
      opacity: 1;
    }
    .subscribe__bar { width: 40px; }
  }
</style>
