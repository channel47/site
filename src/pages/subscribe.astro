---
/**
 * /subscribe — Newsletter signup
 * The Void. Logo, accent bar, pitch, form. Nothing else.
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import LogoAnimated from '../components/LogoAnimated.astro';
import EmailSignup from '../components/EmailSignup.astro';
---

<BaseLayout
  title="Subscribe to Build Notes — Channel 47"
  description="Weekly skill breakdowns, plugin updates, and build process from managing 25+ ad accounts. One email a week."
>
  <main id="main-content" class="min-h-dvh flex items-center">
    <div class="w-full max-w-[1060px] mx-auto px-[clamp(24px,5vw,64px)] py-[clamp(24px,5vw,64px)]">
    <div class="flex flex-col items-start max-w-[480px] w-full">
      <a href="/" class="mb-8" aria-label="Back to Channel 47">
        <LogoAnimated />
      </a>
      <div class="void-page__bar w-0 h-0.5 bg-signal mb-6" aria-hidden="true"></div>
      <p class="label mb-4 void-page__label">BUILD NOTES</p>
      <h1 class="font-display text-[clamp(1.5rem,3vw,2rem)] font-semibold tracking-tight leading-[1.1] text-chalk mb-3 void-page__headline">One skill breakdown a week.</h1>
      <p class="font-mono text-sm leading-relaxed text-dust max-w-[38ch] mb-12 void-page__pitch">How the tools get built, what broke along the way, and the workflows behind 25+ ad accounts.</p>
      <div class="w-full void-page__form">
        <EmailSignup
          placeholder="you@domain.com"
          tag="subscribe"
          submitText="Subscribe"
          variant="prominent"
        />
      </div>
    </div>
    </div>
  </main>
</BaseLayout>

<script>
  const params = new URLSearchParams(window.location.search);
  if (params.get('ref') === 'build') {
    const form = document.querySelector('[data-signup-form]') as HTMLElement;
    if (form) {
      form.dataset.tag = 'build';

      const role = params.get('role');
      const task = params.get('task');
      const tool = params.get('tool');
      const fields: Record<string, string> = {};
      if (role) fields.build_role = role;
      if (task) fields.build_task = task;
      if (tool) fields.build_tool = tool;

      if (Object.keys(fields).length > 0) {
        form.dataset.fields = JSON.stringify(fields);
      }
    }

    window.history.replaceState({}, '', '/subscribe');
  }
</script>
