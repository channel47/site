---
/**
 * AnimatedName
 * A subtle text element that reveals the real name on interaction.
 *
 * Motion design: Soft blur-through crossfade with Y-axis shift.
 * The blur creates a gentle "focus pull" effectâ€”like adjusting a camera lens.
 */
interface Props {
  alias?: string;
  realName?: string;
  class?: string;
}

const {
  alias = 'ctrlswing',
  realName = 'Jackson',
  class: className
} = Astro.props;
---

<span
  class:list={['animated-name', className]}
  tabindex="0"
  role="button"
  aria-label={`Built by ${alias}, also known as ${realName}`}
>
  <span class="animated-name__text animated-name__text--alias">{alias}</span>
  <span class="animated-name__text animated-name__text--real" aria-hidden="true">{realName}</span>
</span>

<style>
  .animated-name {
    position: relative;
    display: inline-block;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    min-width: max-content;
    padding: 4px 8px;
    margin: -4px -8px;
  }

  .animated-name::after {
    content: '';
    position: absolute;
    left: 8px;
    right: 8px;
    bottom: 2px;
    height: 1px;
    background: #292929;
    opacity: 0.6;
    transition: opacity 200ms var(--ease-signature);
  }

  .animated-name:hover::after,
  .animated-name:focus::after,
  .animated-name.is-revealed::after {
    opacity: 0;
  }

  @media (min-width: 768px) {
    .animated-name {
      padding: 0;
      margin: 0;
    }

    .animated-name::after {
      left: 0;
      right: 0;
      bottom: -2px;
    }
  }

  .animated-name__text {
    display: inline-block;
    font-family: var(--font-family-heading);
    transition:
      opacity 200ms var(--ease-signature),
      transform 200ms var(--ease-signature),
      filter 200ms var(--ease-signature);
  }

  .animated-name__text--alias {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }

  .animated-name__text--real {
    position: absolute;
    left: 8px;
    top: 4px;
    opacity: 0;
    transform: translateY(3px);
    filter: blur(4px);
    white-space: nowrap;
  }

  @media (min-width: 768px) {
    .animated-name__text--real {
      left: 0;
      top: 0;
    }
  }

  .animated-name:hover .animated-name__text--alias,
  .animated-name:focus .animated-name__text--alias,
  .animated-name.is-revealed .animated-name__text--alias {
    opacity: 0;
    transform: translateY(-3px);
    filter: blur(4px);
  }

  .animated-name:hover .animated-name__text--real,
  .animated-name:focus .animated-name__text--real,
  .animated-name.is-revealed .animated-name__text--real {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }

  .animated-name:focus-visible {
    outline: 1px solid #292929;
    outline-offset: 4px;
    border-radius: 2px;
  }

  .animated-name:focus:not(:focus-visible) {
    outline: none;
  }

  .animated-name:active {
    transform: scale(0.98);
  }

  @media (prefers-reduced-motion: reduce) {
    .animated-name__text {
      transition: opacity 100ms var(--ease-signature);
      transform: none !important;
      filter: none !important;
    }

    .animated-name::after {
      transition: none;
    }

    .animated-name:active {
      transform: none;
    }
  }
</style>

<script>
  // Touch device handling: toggle on tap for better mobile UX
  function initAnimatedNames() {
    document.querySelectorAll('.animated-name').forEach((el) => {
      if (el.hasAttribute('data-initialized')) return;
      el.setAttribute('data-initialized', 'true');

      let isTouchDevice = false;

      el.addEventListener('touchstart', () => {
        isTouchDevice = true;
      }, { once: true, passive: true });

      el.addEventListener('click', (e) => {
        if (isTouchDevice) {
          e.preventDefault();
          el.classList.toggle('is-revealed');
        }
      });

      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          el.classList.toggle('is-revealed');
        }
      });
    });
  }

  initAnimatedNames();
  document.addEventListener('astro:after-swap', initAnimatedNames);
</script>
