---
/**
 * PurchaseButton Component
 *
 * Stripe-ready purchase button for premium skills.
 * Supports both Stripe Checkout links and custom integration.
 */

interface Props {
  tier: 'free' | 'premium';
  price?: number;
  stripePriceId?: string;
  downloadUrl?: string; // For free skills
  productName: string;
  variant?: 'primary' | 'large';
  class?: string;
}

const {
  tier,
  price,
  stripePriceId,
  downloadUrl,
  productName,
  variant = 'primary',
  class: className,
} = Astro.props;

// For Stripe Checkout, you'd generate this server-side or use Payment Links
// TODO: Replace with actual Stripe Payment Link or checkout URL
const stripeCheckoutUrl = stripePriceId
  ? `https://buy.stripe.com/YOUR_PAYMENT_LINK_ID`
  : null;

const buttonText = tier === 'free'
  ? 'Download Free'
  : `Buy Now — $${price}`;

const href = tier === 'free' ? downloadUrl : stripeCheckoutUrl;
---

<div class:list={['purchase-button-wrapper', className]}>
  {tier === 'premium' && (
    <div class="purchase-button__pricing">
      <span class="purchase-button__price">${price}</span>
      <span class="purchase-button__label">One-time purchase</span>
    </div>
  )}

  <a
    href={href}
    class:list={['purchase-button', `purchase-button--${variant}`]}
    data-stripe-price-id={stripePriceId}
    data-product-name={productName}
    target={tier === 'premium' ? '_blank' : undefined}
    rel={tier === 'premium' ? 'noopener' : undefined}
  >
    <span class="purchase-button__icon">
      {tier === 'free' ? '↓' : '→'}
    </span>
    <span class="purchase-button__text">{buttonText}</span>
  </a>

  {tier === 'premium' && (
    <p class="purchase-button__guarantee">
      30-day money-back guarantee
    </p>
  )}
</div>

<style>
  .purchase-button-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
  }

  .purchase-button__pricing {
    text-align: center;
  }

  .purchase-button__price {
    display: block;
    font-family: var(--font-display);
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    color: var(--color-fg);
    line-height: var(--leading-none);
  }

  .purchase-button__label {
    font-size: var(--text-sm);
    color: var(--color-fg-muted);
  }

  .purchase-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-8);
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    text-decoration: none;
    border-radius: var(--radius-lg);
    transition:
      transform var(--duration-fast) var(--ease-out),
      box-shadow var(--duration-fast) var(--ease-out);
  }

  .purchase-button--primary {
    color: var(--color-void);
    background-color: var(--color-accent);
  }

  .purchase-button--primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--glow-md);
  }

  .purchase-button--large {
    padding: var(--space-5) var(--space-12);
    font-size: var(--text-xl);
    color: var(--color-void);
    background: linear-gradient(
      135deg,
      var(--color-accent) 0%,
      oklch(60% 0.18 30) 100%
    );
  }

  .purchase-button--large:hover {
    transform: translateY(-2px);
    box-shadow: var(--glow-lg);
  }

  .purchase-button__icon {
    font-size: 1.25em;
  }

  .purchase-button__guarantee {
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    margin: 0;
  }
</style>
